<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Benefits Calculator - Free Tool</title>
    <meta name="description" content="Free insurance benefits calculator to determine client responsibility for treatment services. Calculate deductibles, coinsurance, and out-of-pocket costs.">

    <!-- React and Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .calculator-container { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function InsuranceBenefitsCalculator() {
            const [benefits, setBenefits] = useState({
                deductible: '',
                deductibleMet: '',
                oopMax: '',
                oopMet: '',
                coinsurance: ''
            });

            const [services, setServices] = useState({
                detox: { selected: false, dailyRate: '', days: 7 },
                residential: { selected: false, dailyRate: '', days: 21 },
                php: { selected: false, dailyRate: '', days: 30 },
                iop: { selected: false, dailyRate: '', days: 30 }
            });

            const [calculation, setCalculation] = useState(null);

            const serviceInfo = {
                detox: {
                    name: 'Detox',
                    fullName: 'Medical Detoxification',
                    description: 'Medically supervised withdrawal management',
                    defaultRate: 2600
                },
                residential: {
                    name: 'Residential',
                    fullName: 'Residential Treatment Center',
                    description: 'Inpatient residential treatment program',
                    defaultRate: 2000
                },
                php: {
                    name: 'PHP',
                    fullName: 'Partial Hospitalization Program',
                    description: 'Intensive day treatment program',
                    defaultRate: 400
                },
                iop: {
                    name: 'IOP',
                    fullName: 'Intensive Outpatient Program',
                    description: 'Structured outpatient treatment',
                    defaultRate: 200
                }
            };

            const updateBenefit = (field, value) => {
                setBenefits(prev => ({ ...prev, [field]: value }));
            };

            const toggleService = (service) => {
                setServices(prev => {
                    const isCurrentlySelected = prev[service].selected;
                    const newSelected = !isCurrentlySelected;
                    
                    // If turning on and no rate is set, use default rate
                    const dailyRate = newSelected && !prev[service].dailyRate 
                        ? serviceInfo[service].defaultRate.toString() 
                        : prev[service].dailyRate;
                    
                    return {
                        ...prev,
                        [service]: { 
                            ...prev[service], 
                            selected: newSelected,
                            dailyRate: dailyRate
                        }
                    };
                });
            };

            const updateService = (service, field, value) => {
                setServices(prev => ({
                    ...prev,
                    [service]: { ...prev[service], [field]: value }
                }));
            };

            const setDefaultRates = () => {
                const newServices = { ...services };
                Object.keys(services).forEach(service => {
                    if (newServices[service].selected) {
                        newServices[service].dailyRate = serviceInfo[service].defaultRate.toString();
                    }
                });
                setServices(newServices);
            };

            const resetCalculator = () => {
                setBenefits({
                    deductible: '',
                    deductibleMet: '',
                    oopMax: '',
                    oopMet: '',
                    coinsurance: ''
                });
                setServices({
                    detox: { selected: false, dailyRate: '', days: 7 },
                    residential: { selected: false, dailyRate: '', days: 21 },
                    php: { selected: false, dailyRate: '', days: 30 },
                    iop: { selected: false, dailyRate: '', days: 30 }
                });
                setCalculation(null);
            };

            const calculateResponsibility = () => {
                const selectedServices = Object.entries(services)
                    .filter(([_, service]) => service.selected && service.dailyRate && service.days)
                    .map(([key, service]) => ({
                        name: key,
                        ...service,
                        totalCost: parseFloat(service.dailyRate) * parseInt(service.days)
                    }));

                if (selectedServices.length === 0) {
                    setCalculation(null);
                    return;
                }

                const deductible = parseFloat(benefits.deductible) || 0;
                const deductibleMet = parseFloat(benefits.deductibleMet) || 0;
                const oopMax = parseFloat(benefits.oopMax) || 0;
                const oopMet = benefits.oopMet === '' ? 0 : parseFloat(benefits.oopMet) || 0;
                const coinsurance = parseFloat(benefits.coinsurance) || 0;

                let totalProviderCharges = selectedServices.reduce((sum, service) => sum + service.totalCost, 0);
                
                const remainingDeductible = Math.max(0, deductible - deductibleMet);
                const remainingOOP = Math.max(0, oopMax - oopMet);
                
                // Calculate client responsibility step by step
                // Step 1: Apply deductible first
                const deductibleApplied = Math.min(totalProviderCharges, remainingDeductible);
                
                // Step 2: Apply coinsurance to remaining amount after deductible
                const amountAfterDeductible = Math.max(0, totalProviderCharges - deductibleApplied);
                const coinsuranceAmount = amountAfterDeductible * (coinsurance / 100);
                
                // Step 3: Total client responsibility before OOP cap
                const totalClientResponsibility = deductibleApplied + coinsuranceAmount;
                
                // Step 4: Apply OOP maximum cap - client cannot pay more than remaining OOP
                const finalClientCost = Math.min(totalClientResponsibility, remainingOOP);
                
                // Step 5: Calculate how much of deductible and coinsurance actually gets paid
                let actualDeductiblePaid = Math.min(deductibleApplied, finalClientCost);
                let actualCoinsurancePaid = Math.max(0, finalClientCost - actualDeductiblePaid);
                
                // Step 6: Insurance pays the rest
                const insurancePays = totalProviderCharges - finalClientCost;

                setCalculation({
                    services: selectedServices,
                    totals: {
                        providerCharges: totalProviderCharges,
                        deductibleApplied: actualDeductiblePaid,
                        coinsuranceAmount: actualCoinsurancePaid,
                        totalClientCost: finalClientCost,
                        insurancePays: insurancePays,
                        remainingDeductible: Math.max(0, remainingDeductible - actualDeductiblePaid),
                        remainingOOP: Math.max(0, remainingOOP - finalClientCost),
                        theoreticalResponsibility: totalClientResponsibility,
                        oopMaxReached: finalClientCost < totalClientResponsibility
                    }
                });
            };

            useEffect(() => {
                calculateResponsibility();
            }, [benefits, services]);

            return (
                <div className="min-h-screen bg-gray-50 calculator-container">
                    <div className="max-w-6xl mx-auto p-4">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800 mb-2">Insurance Benefits Calculator</h1>
                                    <p className="text-gray-600">Calculate client responsibility for treatment services and negotiate payment options</p>
                                </div>
                                <button
                                    onClick={resetCalculator}
                                    className="px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    Reset Calculator
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Input Section */}
                            <div className="space-y-6">
                                {/* Benefits Information */}
                                <div className="bg-white rounded-lg shadow-sm p-6">
                                    <h2 className="text-lg font-semibold text-gray-800 mb-4">Insurance Benefits</h2>
                                    
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Annual Deductible ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.deductible}
                                                    onChange={(e) => updateBenefit('deductible', e.target.value)}
                                                    placeholder="5000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Deductible Met ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.deductibleMet}
                                                    onChange={(e) => updateBenefit('deductibleMet', e.target.value)}
                                                    placeholder="1500"
                                                />
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Out-of-Pocket Max ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.oopMax}
                                                    onChange={(e) => updateBenefit('oopMax', e.target.value)}
                                                    placeholder="8000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">OOP Met ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.oopMet}
                                                    onChange={(e) => updateBenefit('oopMet', e.target.value)}
                                                    placeholder="2000"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Coinsurance (%)</label>
                                            <input
                                                type="number"
                                                min="0"
                                                max="100"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                value={benefits.coinsurance}
                                                onChange={(e) => updateBenefit('coinsurance', e.target.value)}
                                                placeholder="20"
                                            />
                                        </div>
                                    </div>
                                </div>

                                {/* Treatment Services */}
                                <div className="bg-white rounded-lg shadow-sm p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-gray-800">Treatment Services</h2>
                                        <button
                                            onClick={setDefaultRates}
                                            className="text-sm text-blue-600 hover:text-blue-700 font-medium"
                                        >
                                            Set Default Rates for Selected
                                        </button>
                                    </div>

                                    <div className="space-y-3">
                                        {Object.entries(serviceInfo).map(([key, info]) => (
                                            <div 
                                                key={key} 
                                                className={`border rounded-lg p-4 transition-all ${
                                                    services[key].selected 
                                                        ? 'border-blue-300 bg-blue-50' 
                                                        : 'border-gray-200 hover:border-gray-300'
                                                }`}
                                            >
                                                <label className="flex items-start cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={services[key].selected}
                                                        onChange={() => toggleService(key)}
                                                        className="h-4 w-4 text-blue-600 rounded mt-1"
                                                    />
                                                    <div className="ml-3 flex-1">
                                                        <div className="font-medium text-gray-800">{info.fullName}</div>
                                                        <div className="text-sm text-gray-600">{info.description}</div>
                                                    </div>
                                                </label>

                                                {services[key].selected && (
                                                    <div className="ml-7 mt-3 grid grid-cols-2 gap-3">
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                                            <input
                                                                type="number"
                                                                className="w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                                value={services[key].dailyRate}
                                                                onChange={(e) => updateService(key, 'dailyRate', e.target.value)}
                                                                placeholder={info.defaultRate.toString()}
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Number of Days</label>
                                                            <input
                                                                type="number"
                                                                min="1"
                                                                className="w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                                value={services[key].days}
                                                                onChange={(e) => updateService(key, 'days', e.target.value)}
                                                            />
                                                        </div>
                                                        {services[key].dailyRate && services[key].days && (
                                                            <div className="col-span-2 text-center p-2 bg-white rounded border border-blue-200">
                                                                <span className="text-sm text-gray-600">Service Total: </span>
                                                                <span className="font-semibold text-blue-600">
                                                                    ${(parseFloat(services[key].dailyRate) * parseInt(services[key].days)).toLocaleString()}
                                                                </span>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Results Section */}
                            <div>
                                {calculation && calculation.services.length > 0 ? (
                                    <div className="space-y-6">
                                        {/* Insurance Rules - Simple */}
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <div className="text-sm text-gray-700 space-y-1">
                                                <div>• Until Deductible: Client pays 100%</div>
                                                <div>• After Deductible: Client pays coinsurance {benefits.coinsurance || '[enter %]'}%</div>
                                                <div>• After OOP Max: Insurance pays 100%</div>
                                            </div>
                                        </div>

                                        {/* Main Result */}
                                        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm p-6 text-white">
                                            <h3 className="text-lg font-semibold mb-4">Client Responsibility</h3>
                                            <div className="text-center mb-6">
                                                <div className="text-5xl font-bold mb-2">
                                                    ${calculation.totals.totalClientCost.toLocaleString()}
                                                </div>
                                                <p className="text-blue-100">Total amount client will pay</p>
                                                {calculation.totals.oopMaxReached && (
                                                    <div className="mt-3 bg-white/20 rounded-lg px-4 py-2 text-sm">
                                                        <span className="font-semibold">✓ OOP Max Reached</span> - Capped at remaining maximum
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4 text-sm">
                                                <div className="bg-white/10 rounded p-3">
                                                    <div className="text-blue-100">Insurance Pays</div>
                                                    <div className="text-xl font-semibold">${calculation.totals.insurancePays.toLocaleString()}</div>
                                                </div>
                                                <div className="bg-white/10 rounded p-3">
                                                    <div className="text-blue-100">Total Charges</div>
                                                    <div className="text-xl font-semibold">${calculation.totals.providerCharges.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Payment Negotiation Options */}
                                        <div className="bg-white rounded-lg shadow-sm p-6">
                                            <h4 className="text-lg font-semibold text-gray-800 mb-4">Payment Collection Options</h4>
                                            <div className="bg-blue-50 p-4 rounded-lg mb-4">
                                                <p className="text-sm text-blue-800"><strong>Purpose:</strong> Help clients access treatment when they cannot afford the full amount upfront. These options show the value of different payment amounts.</p>
                                            </div>
                                            
                                            <div className="space-y-4">
                                                {/* Option 1: Deductible Only */}
                                                <div className="border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold mb-2">
                                                                Option 1 - Minimum
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay Deductible Portion Only</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-gray-800">
                                                                ${calculation.totals.deductibleApplied.toLocaleString()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-gray-50 p-3 rounded">
                                                            <div className="font-medium mb-1">Payment Breakdown:</div>
                                                            <div className="space-y-1 text-xs">
                                                                <div>• Client pays now: ${calculation.totals.deductibleApplied.toLocaleString()}</div>
                                                                <div>• Insurance pays: ${calculation.totals.insurancePays.toLocaleString()}</div>
                                                                <div>• Remaining balance to collect: ${(calculation.totals.totalClientCost - calculation.totals.deductibleApplied).toLocaleString()}</div>
                                                                <div className="font-semibold pt-1 border-t">Total Coverage: ${(calculation.totals.deductibleApplied + calculation.totals.insurancePays).toLocaleString()}</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-xs text-gray-500">
                                                            Best for clients who cannot pay full amount now but can handle future payments
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Option 2: 50% of Client Responsibility */}
                                                <div className="border-2 border-blue-200 rounded-lg p-4 hover:border-blue-400 transition-colors bg-blue-50">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold mb-2">
                                                                Option 2 - Partial
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay 50% of Client Responsibility</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-blue-700">
                                                                ${Math.round(calculation.totals.totalClientCost * 0.5).toLocaleString()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-blue-50 p-3 rounded border border-blue-200">
                                                            <div className="font-medium mb-1">Payment Breakdown:</div>
                                                            <div className="space-y-1 text-xs">
                                                                <div>• Client pays now: ${Math.round(calculation.totals.totalClientCost * 0.5).toLocaleString()}</div>
                                                                <div>• Insurance pays: ${calculation.totals.insurancePays.toLocaleString()}</div>
                                                                <div>• Remaining balance to collect: ${Math.round(calculation.totals.totalClientCost * 0.5).toLocaleString()}</div>
                                                                <div className="font-semibold pt-1 border-t">Total Coverage: ${(Math.round(calculation.totals.totalClientCost * 0.5) + calculation.totals.insurancePays).toLocaleString()}</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-xs text-blue-600">
                                                            Good middle ground - shows commitment while being manageable
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Option 3: Full Client Responsibility */}
                                                <div className="border-2 border-green-200 rounded-lg p-4 hover:border-green-400 transition-colors">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold mb-2">
                                                                Option 3 - Full Payment
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay Full Client Responsibility</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-green-700">
                                                                ${calculation.totals.totalClientCost.toLocaleString()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-green-50 p-3 rounded border border-green-200">
                                                            <div className="font-medium mb-1">Payment Breakdown:</div>
                                                            <div className="space-y-1 text-xs">
                                                                <div>• Client pays now: ${calculation.totals.totalClientCost.toLocaleString()}</div>
                                                                <div>• Insurance pays: ${calculation.totals.insurancePays.toLocaleString()}</div>
                                                                <div>• Remaining balance to collect: $0</div>
                                                                <div className="font-semibold pt-1 border-t">Total Coverage: ${calculation.totals.providerCharges.toLocaleString()}</div>
                                                            </div>
                                                        </div>
                                                        <div className="bg-white p-3 rounded border border-green-300">
                                                            <div className="text-center">
                                                                <div className="text-lg font-bold text-green-700">✓ Paid in Full</div>
                                                                <div className="text-xs text-green-600">No future billing required for this treatment</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-xs text-green-600">
                                                            Best for clients who can afford upfront payment and want certainty
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Option 4: Minimum Viable Payment */}
                                                <div className="border-2 border-purple-200 rounded-lg p-4 hover:border-purple-400 transition-colors bg-purple-50">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-purple-100 text-purple-700 rounded-full text-sm font-semibold mb-2">
                                                                Option 4 - Hardship
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Minimum Viable Payment</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-purple-700">
                                                                $1,000
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-purple-50 p-3 rounded border border-purple-200">
                                                            <div className="font-medium mb-1">Payment Breakdown:</div>
                                                            <div className="space-y-1 text-xs">
                                                                <div>• Client pays now: $1,000</div>
                                                                <div>• Insurance pays: ${calculation.totals.insurancePays.toLocaleString()}</div>
                                                                <div>• Remaining balance to collect: ${(calculation.totals.totalClientCost - 1000).toLocaleString()}</div>
                                                                <div className="font-semibold pt-1 border-t">Total Coverage: ${(1000 + calculation.totals.insurancePays).toLocaleString()}</div>
                                                            </div>
                                                        </div>
                                                        <div className="text-xs text-purple-600">
                                                            For clients in crisis who cannot afford standard payment options
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Detailed Breakdown */}
                                        <div className="bg-white rounded-lg shadow-sm p-6">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Cost Breakdown</h3>
                                            
                                            <div className="mb-6">
                                                <h4 className="text-sm font-medium text-gray-700 mb-3">Selected Services</h4>
                                                <div className="space-y-2">
                                                    {calculation.services.map((service, idx) => (
                                                        <div key={idx} className="flex justify-between items-center py-2 border-b border-gray-100">
                                                            <span className="text-sm text-gray-600">
                                                                {serviceInfo[service.name].fullName} ({service.days} days @ ${service.dailyRate}/day)
                                                            </span>
                                                            <span className="font-medium">${service.totalCost.toLocaleString()}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center py-2">
                                                    <span className="text-sm text-gray-600">Total Provider Charges</span>
                                                    <span className="font-medium">${calculation.totals.providerCharges.toLocaleString()}</span>
                                                </div>
                                                
                                                <div className="flex justify-between items-center py-2 border-t pt-3">
                                                    <span className="text-sm text-gray-600">Deductible Applied</span>
                                                    <span className="font-medium text-red-600">-${calculation.totals.deductibleApplied.toLocaleString()}</span>
                                                </div>
                                                
                                                <div className="flex justify-between items-center py-2">
                                                    <span className="text-sm text-gray-600">Coinsurance ({benefits.coinsurance}%)</span>
                                                    <span className="font-medium text-red-600">-${calculation.totals.coinsuranceAmount.toLocaleString()}</span>
                                                </div>
                                                
                                                {calculation.totals.oopMaxReached && (
                                                    <div className="py-2 px-3 bg-green-50 rounded border border-green-200">
                                                        <div className="text-sm text-green-700 font-medium">
                                                            Out-of-Pocket Maximum Reached
                                                        </div>
                                                        <div className="text-xs text-green-600 mt-1">
                                                            Responsibility capped at remaining OOP max: ${(parseFloat(benefits.oopMax || 0) - parseFloat(benefits.oopMet || 0)).toLocaleString()}
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between items-center py-3 border-t font-semibold">
                                                    <span>Total Client Responsibility</span>
                                                    <span className="text-lg text-indigo-600">${calculation.totals.totalClientCost.toLocaleString()}</span>
                                                </div>
                                            </div>

                                            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                                <h4 className="text-sm font-medium text-gray-700 mb-3">Benefit Progress</h4>
                                                <div className="space-y-3">
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-600">Deductible Progress</span>
                                                            <span className="font-medium">${(parseFloat(benefits.deductibleMet) || 0).toLocaleString()} / ${(parseFloat(benefits.deductible) || 0).toLocaleString()}</span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div 
                                                                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                                style={{width: `${Math.min(100, ((parseFloat(benefits.deductibleMet) || 0) / Math.max(1, parseFloat(benefits.deductible) || 1)) * 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-600">Out-of-Pocket Progress</span>
                                                            <span className="font-medium">${(benefits.oopMet === '' ? 0 : parseFloat(benefits.oopMet) || 0).toLocaleString()} / ${(parseFloat(benefits.oopMax) || 0).toLocaleString()}</span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div 
                                                                className="bg-green-600 h-2 rounded-full transition-all duration-300"
                                                                style={{width: `${Math.min(100, ((benefits.oopMet === '' ? 0 : parseFloat(benefits.oopMet) || 0) / Math.max(1, parseFloat(benefits.oopMax) || 1)) * 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                                <div className="mt-3 grid grid-cols-2 gap-4 text-sm">
                                                    <div>
                                                        <span className="text-gray-600">Deductible Remaining:</span>
                                                        <span className="ml-2 font-medium">${calculation.totals.remainingDeductible.toLocaleString()}</span>
                                                    </div>
                                                    <div>
                                                        <span className="text-gray-600">OOP Max Remaining:</span>
                                                        <span className="ml-2 font-medium">${calculation.totals.remainingOOP.toLocaleString()}</span>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Staff Guidelines */}
                                        <div className="bg-green-50 border border-green-200 rounded-lg p-6">
                                            <h4 className="text-lg font-semibold text-green-800 mb-4">Collection Guidelines for Staff</h4>
                                            
                                            <div className="space-y-4">
                                                <div className="bg-white rounded-lg p-4 border border-green-300">
                                                    <div className="font-semibold text-green-800 mb-2">Recommended Collection Strategy:</div>
                                                    <div className="space-y-2 text-sm text-green-700">
                                                        <div>1. <strong>Start with Option 3</strong> - Explain value of paying toward OOP maximum</div>
                                                        <div>2. <strong>If unable, offer Option 2</strong> - 50% payment shows good faith</div>
                                                        <div>3. <strong>If still unable, try Option 1</strong> - At minimum, collect deductible portion</div>
                                                        <div>4. <strong>For hardship cases</strong> - Use Option 4 and discuss payment plans</div>
                                                    </div>
                                                </div>
                                                
                                                <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                                    <div className="bg-white rounded-lg p-4 border border-green-300">
                                                        <div className="font-semibold text-green-800 mb-2">Key Points to Explain:</div>
                                                        <div className="space-y-1 text-sm text-green-700">
                                                            <div>• Insurance benefits are annual limits</div>
                                                            <div>• Payments apply to deductible/OOP max</div>
                                                            <div>• Future services cost less as limits are met</div>
                                                            <div>• Treatment should not be delayed for payment</div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="bg-white rounded-lg p-4 border border-green-300">
                                                        <div className="font-semibold text-green-800 mb-2">Documentation Required:</div>
                                                        <div className="space-y-1 text-sm text-green-700">
                                                            <div>• Payment option selected and why</div>
                                                            <div>• Patient's financial situation discussed</div>
                                                            <div>• Any payment plan arrangements</div>
                                                            <div>• Follow-up collection dates scheduled</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                            <p className="text-sm text-amber-800">
                                                <strong>Disclaimer:</strong> This is an estimate based on the benefits information provided. 
                                                Actual costs may vary depending on final coding, medical necessity determinations, and other factors.
                                                Always verify benefits with the insurance company for complex cases.
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-sm p-12 text-center">
                                        <div className="text-gray-400 mb-4">
                                            <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">No Calculation Yet</h3>
                                        <p className="text-gray-600">Enter benefits information and select services to see the cost calculation and payment options</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="mt-8 text-center text-sm text-gray-500">
                            <p>Free Insurance Benefits Calculator - Streamlined for Treatment Facilities</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<InsuranceBenefitsCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
