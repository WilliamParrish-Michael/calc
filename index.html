<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Benefits Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        .service-selected {
            border-color: #3B82F6 !important;
            background-color: #EFF6FF !important;
        }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <div class="max-w-6xl mx-auto p-4">
        <!-- Header -->
        <div class="bg-white rounded-lg shadow-sm p-6 mb-6">
            <h1 class="text-2xl font-bold text-gray-800 mb-2">Insurance Benefits Calculator</h1>
            <p class="text-gray-600">Calculate client responsibility for treatment services and negotiate payment options</p>
            <button onclick="resetAll()" class="mt-4 px-4 py-2 bg-gray-100 text-gray-700 rounded hover:bg-gray-200">Reset Calculator</button>
        </div>

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
            <!-- Input Section -->
            <div class="space-y-6">
                <!-- Benefits Information -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Insurance Benefits</h2>
                    
                    <div class="space-y-4">
                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Annual Deductible ($)</label>
                                <input type="number" id="deductible" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="5000" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Deductible Met ($)</label>
                                <input type="number" id="deductibleMet" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="1500" onkeyup="calculate()">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Out-of-Pocket Max ($)</label>
                                <input type="number" id="oopMax" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="8000" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">OOP Met ($)</label>
                                <input type="number" id="oopMet" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="2000" onkeyup="calculate()">
                            </div>
                        </div>

                        <div class="grid grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Coinsurance (%)</label>
                                <input type="number" id="coinsurance" min="0" max="100" class="w-full px-3 py-2 border border-gray-300 rounded-lg" placeholder="20" onkeyup="updateInsurance(); calculate();">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-gray-700 mb-1">Insurance Portion (%)</label>
                                <input type="number" id="insurance" class="w-full px-3 py-2 border border-gray-300 rounded-lg bg-gray-50" readonly>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Treatment Services -->
                <div class="bg-white rounded-lg shadow-sm p-6">
                    <h2 class="text-lg font-semibold text-gray-800 mb-4">Treatment Services</h2>
                    
                    <!-- Detox -->
                    <div class="border rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-50" id="detox-card" onclick="toggleService('detox')">
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="detox-check" class="mr-3">
                            <div>
                                <div class="font-medium">Medical Detoxification</div>
                                <div class="text-sm text-gray-600">Medically supervised withdrawal management</div>
                            </div>
                        </div>
                        <div id="detox-inputs" class="hidden grid-cols-3 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                <input type="number" id="detox-rate" value="2600" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Days</label>
                                <input type="number" id="detox-days" value="7" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Total</label>
                                <div id="detox-total" class="px-2 py-1 bg-blue-50 rounded text-sm font-semibold">$18,200</div>
                            </div>
                        </div>
                    </div>

                    <!-- Residential -->
                    <div class="border rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-50" id="residential-card" onclick="toggleService('residential')">
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="residential-check" class="mr-3">
                            <div>
                                <div class="font-medium">Residential Treatment Center</div>
                                <div class="text-sm text-gray-600">Inpatient residential treatment program</div>
                            </div>
                        </div>
                        <div id="residential-inputs" class="hidden grid-cols-3 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                <input type="number" id="residential-rate" value="2000" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Days</label>
                                <input type="number" id="residential-days" value="21" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Total</label>
                                <div id="residential-total" class="px-2 py-1 bg-blue-50 rounded text-sm font-semibold">$42,000</div>
                            </div>
                        </div>
                    </div>

                    <!-- PHP -->
                    <div class="border rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-50" id="php-card" onclick="toggleService('php')">
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="php-check" class="mr-3">
                            <div>
                                <div class="font-medium">Partial Hospitalization Program (PHP)</div>
                                <div class="text-sm text-gray-600">Intensive day treatment program</div>
                            </div>
                        </div>
                        <div id="php-inputs" class="hidden grid-cols-3 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                <input type="number" id="php-rate" value="400" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Days</label>
                                <input type="number" id="php-days" value="30" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Total</label>
                                <div id="php-total" class="px-2 py-1 bg-blue-50 rounded text-sm font-semibold">$12,000</div>
                            </div>
                        </div>
                    </div>

                    <!-- IOP -->
                    <div class="border rounded-lg p-4 mb-3 cursor-pointer hover:bg-gray-50" id="iop-card" onclick="toggleService('iop')">
                        <div class="flex items-center mb-3">
                            <input type="checkbox" id="iop-check" class="mr-3">
                            <div>
                                <div class="font-medium">Intensive Outpatient Program (IOP)</div>
                                <div class="text-sm text-gray-600">Structured outpatient treatment</div>
                            </div>
                        </div>
                        <div id="iop-inputs" class="hidden grid-cols-3 gap-3">
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                <input type="number" id="iop-rate" value="200" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Days</label>
                                <input type="number" id="iop-days" value="30" class="w-full px-2 py-1 border rounded text-sm" onclick="event.stopPropagation()" onkeyup="calculate()">
                            </div>
                            <div>
                                <label class="block text-xs font-medium text-gray-700 mb-1">Total</label>
                                <div id="iop-total" class="px-2 py-1 bg-blue-50 rounded text-sm font-semibold">$6,000</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Results Section -->
            <div>
                <div id="results" class="bg-white rounded-lg shadow-sm p-6">
                    <h3 class="text-lg font-semibold text-gray-800 mb-4">Results</h3>
                    <div class="text-center py-8 text-gray-500">
                        <div class="text-4xl mb-2">📊</div>
                        <p>Select services and enter benefit information to see calculations</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Update insurance portion when coinsurance changes
        function updateInsurance() {
            const coinsurance = document.getElementById('coinsurance').value;
            const insurance = document.getElementById('insurance');
            
            if (coinsurance && coinsurance >= 0 && coinsurance <= 100) {
                insurance.value = 100 - parseFloat(coinsurance);
            } else {
                insurance.value = '';
            }
        }

        // Toggle service visibility
        function toggleService(serviceName) {
            const checkbox = document.getElementById(serviceName + '-check');
            const inputs = document.getElementById(serviceName + '-inputs');
            const card = document.getElementById(serviceName + '-card');

            checkbox.checked = !checkbox.checked;

            if (checkbox.checked) {
                inputs.classList.remove('hidden');
                inputs.classList.add('grid');
                card.classList.add('service-selected');
            } else {
                inputs.classList.add('hidden');
                inputs.classList.remove('grid');
                card.classList.remove('service-selected');
            }

            updateServiceTotal(serviceName);
            calculate();
        }

        // Update individual service total
        function updateServiceTotal(serviceName) {
            const rate = parseFloat(document.getElementById(serviceName + '-rate').value) || 0;
            const days = parseFloat(document.getElementById(serviceName + '-days').value) || 0;
            const total = rate * days;
            
            document.getElementById(serviceName + '-total').textContent = '$' + total.toLocaleString();
        }

        // Main calculation function
        function calculate() {
            // Update all service totals first
            ['detox', 'residential', 'php', 'iop'].forEach(service => {
                if (document.getElementById(service + '-check').checked) {
                    updateServiceTotal(service);
                }
            });

            // Get selected services
            const selectedServices = [];
            ['detox', 'residential', 'php', 'iop'].forEach(service => {
                if (document.getElementById(service + '-check').checked) {
                    const rate = parseFloat(document.getElementById(service + '-rate').value) || 0;
                    const days = parseFloat(document.getElementById(service + '-days').value) || 0;
                    if (rate > 0 && days > 0) {
                        selectedServices.push({
                            name: service,
                            rate: rate,
                            days: days,
                            total: rate * days
                        });
                    }
                }
            });

            if (selectedServices.length === 0) {
                showNoResults();
                return;
            }

            // Get benefit values
            const deductible = parseFloat(document.getElementById('deductible').value) || 0;
            const deductibleMet = parseFloat(document.getElementById('deductibleMet').value) || 0;
            const oopMax = parseFloat(document.getElementById('oopMax').value) || 0;
            const oopMet = parseFloat(document.getElementById('oopMet').value) || 0;
            const coinsurance = parseFloat(document.getElementById('coinsurance').value) || 0;

            // Calculate totals
            const totalCharges = selectedServices.reduce((sum, service) => sum + service.total, 0);
            const remainingDeductible = Math.max(0, deductible - deductibleMet);
            const remainingOOP = Math.max(0, oopMax - oopMet);

            // Calculate client responsibility
            const deductibleApplied = Math.min(totalCharges, remainingDeductible);
            const amountAfterDeductible = Math.max(0, totalCharges - deductibleApplied);
            const coinsuranceAmount = amountAfterDeductible * (coinsurance / 100);
            const totalClientResponsibility = deductibleApplied + coinsuranceAmount;
            const finalClientCost = Math.min(totalClientResponsibility, remainingOOP);
            const insurancePays = totalCharges - finalClientCost;

            showResults({
                totalCharges: totalCharges,
                clientCost: finalClientCost,
                insurancePays: insurancePays,
                deductibleApplied: deductibleApplied,
                coinsuranceAmount: Math.max(0, finalClientCost - deductibleApplied),
                services: selectedServices
            });
        }

        // Show calculation results
        function showResults(calc) {
            const resultsDiv = document.getElementById('results');
            resultsDiv.innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Calculation Results</h3>
                
                <!-- Main Result -->
                <div class="bg-blue-600 text-white rounded-lg p-6 mb-6">
                    <div class="text-center">
                        <div class="text-4xl font-bold mb-2">$${calc.clientCost.toLocaleString()}</div>
                        <div class="text-blue-100">Total Client Responsibility</div>
                    </div>
                    <div class="grid grid-cols-2 gap-4 mt-4 text-sm">
                        <div class="bg-blue-500 rounded p-3 text-center">
                            <div class="text-blue-100">Insurance Pays</div>
                            <div class="text-xl font-bold">$${calc.insurancePays.toLocaleString()}</div>
                        </div>
                        <div class="bg-blue-500 rounded p-3 text-center">
                            <div class="text-blue-100">Total Charges</div>
                            <div class="text-xl font-bold">$${calc.totalCharges.toLocaleString()}</div>
                        </div>
                    </div>
                </div>

                <!-- Payment Options -->
                <div class="space-y-4">
                    <h4 class="font-semibold text-gray-800">Payment Collection Options</h4>
                    
                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Option 1 - Deductible Only</div>
                                <div class="text-sm text-gray-600">Pay deductible portion</div>
                            </div>
                            <div class="text-xl font-bold">$${calc.deductibleApplied.toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="border-2 border-blue-200 bg-blue-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Option 2 - 50% Responsibility</div>
                                <div class="text-sm text-gray-600">Pay half of total responsibility</div>
                            </div>
                            <div class="text-xl font-bold text-blue-700">$${(calc.clientCost * 0.5).toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="border rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Option 3 - Full Payment</div>
                                <div class="text-sm text-gray-600">Pay complete responsibility</div>
                            </div>
                            <div class="text-xl font-bold text-green-700">$${calc.clientCost.toLocaleString()}</div>
                        </div>
                    </div>

                    <div class="border border-purple-200 bg-purple-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Option 4 - Minimum Payment</div>
                                <div class="text-sm text-gray-600">Hardship minimum</div>
                            </div>
                            <div class="text-xl font-bold text-purple-700">$1,000</div>
                        </div>
                    </div>

                    <div class="border border-red-200 bg-red-50 rounded-lg p-4">
                        <div class="flex justify-between items-center">
                            <div>
                                <div class="font-medium">Option 5 - Emergency</div>
                                <div class="text-sm text-red-600">⚠️ Collect nothing upfront</div>
                            </div>
                            <div class="text-xl font-bold text-red-700">$0</div>
                        </div>
                    </div>
                </div>

                <!-- Breakdown -->
                <div class="mt-6 p-4 bg-gray-50 rounded">
                    <h5 class="font-medium mb-2">Cost Breakdown</h5>
                    <div class="space-y-1 text-sm">
                        <div class="flex justify-between">
                            <span>Total Provider Charges:</span>
                            <span>$${calc.totalCharges.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between text-red-600">
                            <span>Client Responsibility:</span>
                            <span>-$${calc.clientCost.toLocaleString()}</span>
                        </div>
                        <div class="flex justify-between text-green-600 font-medium border-t pt-1">
                            <span>Insurance Pays:</span>
                            <span>$${calc.insurancePays.toLocaleString()}</span>
                        </div>
                    </div>
                </div>
            `;
        }

        // Show no results message
        function showNoResults() {
            document.getElementById('results').innerHTML = `
                <h3 class="text-lg font-semibold text-gray-800 mb-4">Results</h3>
                <div class="text-center py-8 text-gray-500">
                    <div class="text-4xl mb-2">📊</div>
                    <p>Select services and enter benefit information to see calculations</p>
                </div>
            `;
        }

        // Reset everything
        function resetAll() {
            // Reset benefit inputs
            document.getElementById('deductible').value = '';
            document.getElementById('deductibleMet').value = '';
            document.getElementById('oopMax').value = '';
            document.getElementById('oopMet').value = '';
            document.getElementById('coinsurance').value = '';
            document.getElementById('insurance').value = '';

            // Reset all services
            ['detox', 'residential', 'php', 'iop'].forEach(service => {
                const checkbox = document.getElementById(service + '-check');
                const inputs = document.getElementById(service + '-inputs');
                const card = document.getElementById(service + '-card');

                checkbox.checked = false;
                inputs.classList.add('hidden');
                inputs.classList.remove('grid');
                card.classList.remove('service-selected');
            });

            showNoResults();
        }

        // Initialize
        showNoResults();
    </script>
</body>
</html>
