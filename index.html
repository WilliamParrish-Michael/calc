<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Benefits Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function InsuranceBenefitsCalculator() {
            // Insurance Benefits State
            const [benefits, setBenefits] = useState({
                deductible: '',
                deductibleMet: '',
                oopMax: '',
                oopMet: '',
                coinsurance: '',
                isInNetwork: true
            });

            // Services State with default days
            const [services, setServices] = useState([
                { id: 'detox', name: 'Detox', fullName: 'Medical Detoxification', selected: false, dailyRate: '', days: '7' },
                { id: 'residential', name: 'Residential', fullName: 'Residential Treatment', selected: false, dailyRate: '', days: '21' },
                { id: 'php', name: 'PHP', fullName: 'Partial Hospitalization Program', selected: false, dailyRate: '', days: '30' },
                { id: 'iop', name: 'IOP', fullName: 'Intensive Outpatient Program', selected: false, dailyRate: '', days: '30' }
            ]);

            // Calculation state
            const [calculation, setCalculation] = useState(null);

            // Update benefit field
            const updateBenefit = (field, value) => {
                setBenefits(prev => ({ ...prev, [field]: value }));
            };

            // Toggle service selection
            const toggleService = (serviceId) => {
                setServices(prev => prev.map(service => 
                    service.id === serviceId 
                        ? { ...service, selected: !service.selected }
                        : service
                ));
            };

            // Update service field
            const updateService = (serviceId, field, value) => {
                setServices(prev => prev.map(service => 
                    service.id === serviceId 
                        ? { ...service, [field]: value }
                        : service
                ));
            };

            // Calculate responsibility
            const calculateResponsibility = () => {
                // Get selected services with valid data
                const selectedServices = services.filter(s => 
                    s.selected && s.dailyRate && s.days
                );

                if (selectedServices.length === 0) {
                    setCalculation(null);
                    return;
                }

                // Parse benefit values
                const deductible = parseFloat(benefits.deductible) || 0;
                const deductibleMet = parseFloat(benefits.deductibleMet) || 0;
                const oopMax = parseFloat(benefits.oopMax) || 0;
                const oopMet = parseFloat(benefits.oopMet) || 0;
                const coinsurance = parseFloat(benefits.coinsurance) || 0;

                // Calculate service totals
                const serviceDetails = selectedServices.map(service => ({
                    ...service,
                    totalCost: parseFloat(service.dailyRate) * parseInt(service.days)
                }));

                const totalCharges = serviceDetails.reduce((sum, s) => sum + s.totalCost, 0);
                const allowedAmount = benefits.isInNetwork ? totalCharges : totalCharges * 0.8;

                // Calculate remaining benefits
                const remainingDeductible = Math.max(0, deductible - deductibleMet);
                const remainingOOP = Math.max(0, oopMax - oopMet);

                // Calculate patient responsibility
                const deductibleResponsibility = Math.min(allowedAmount, remainingDeductible);
                const amountAfterDeductible = Math.max(0, allowedAmount - deductibleResponsibility);
                const coinsuranceResponsibility = amountAfterDeductible * (coinsurance / 100);
                
                // Total responsibility before OOP max
                const theoreticalResponsibility = deductibleResponsibility + coinsuranceResponsibility;
                
                // Apply OOP max limit
                const actualResponsibility = Math.min(theoreticalResponsibility, remainingOOP);
                
                // Calculate actual payments
                const actualDeductiblePaid = Math.min(deductibleResponsibility, remainingOOP);
                const actualCoinsurancePaid = Math.max(0, actualResponsibility - actualDeductiblePaid);
                
                // Balance billing for out-of-network
                const balanceBilling = !benefits.isInNetwork ? totalCharges - allowedAmount : 0;
                
                // Insurance payment
                const insurancePays = allowedAmount - actualResponsibility;
                
                // Total client cost
                const totalClientCost = actualResponsibility + balanceBilling;

                setCalculation({
                    services: serviceDetails,
                    totalCharges,
                    allowedAmount,
                    deductibleResponsibility: actualDeductiblePaid,
                    coinsuranceResponsibility: actualCoinsurancePaid,
                    balanceBilling,
                    insurancePays,
                    totalClientCost,
                    remainingDeductible: Math.max(0, remainingDeductible - actualDeductiblePaid),
                    remainingOOP: Math.max(0, remainingOOP - actualResponsibility),
                    oopMaxReached: actualResponsibility < theoreticalResponsibility,
                    coinsurancePercentage: coinsurance,
                    insuranceCoinsurancePercentage: 100 - coinsurance
                });
            };

            // Recalculate when inputs change
            useEffect(() => {
                calculateResponsibility();
            }, [benefits, services]);

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-6xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h1 className="text-2xl font-bold text-gray-800">Insurance Benefits Calculator</h1>
                            <p className="text-gray-600 mt-1">Calculate client responsibility for treatment services</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Left Column - Inputs */}
                            <div className="space-y-6">
                                {/* Insurance Benefits */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-lg font-semibold mb-4">Insurance Benefits</h2>
                                    
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Annual Deductible ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.deductible}
                                                    onChange={(e) => updateBenefit('deductible', e.target.value)}
                                                    placeholder="5000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Deductible Met ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.deductibleMet}
                                                    onChange={(e) => updateBenefit('deductibleMet', e.target.value)}
                                                    placeholder="1500"
                                                />
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Out-of-Pocket Max ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.oopMax}
                                                    onChange={(e) => updateBenefit('oopMax', e.target.value)}
                                                    placeholder="8000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    OOP Met ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.oopMet}
                                                    onChange={(e) => updateBenefit('oopMet', e.target.value)}
                                                    placeholder="2000"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Coinsurance (Patient %)
                                            </label>
                                            <div className="flex items-center space-x-2">
                                                <input
                                                    type="number"
                                                    min="0"
                                                    max="100"
                                                    className="w-24 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.coinsurance}
                                                    onChange={(e) => updateBenefit('coinsurance', e.target.value)}
                                                    placeholder="20"
                                                />
                                                <span className="text-sm text-gray-600">%</span>
                                                {benefits.coinsurance && (
                                                    <span className="text-sm text-gray-600 ml-4">
                                                        (Insurance pays: {100 - parseFloat(benefits.coinsurance)}%)
                                                    </span>
                                                )}
                                            </div>
                                        </div>

                                        <div className="flex items-center space-x-6">
                                            <label className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    checked={benefits.isInNetwork}
                                                    onChange={() => updateBenefit('isInNetwork', true)}
                                                    className="mr-2"
                                                />
                                                <span className="text-sm font-medium">In-Network</span>
                                            </label>
                                            <label className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    checked={!benefits.isInNetwork}
                                                    onChange={() => updateBenefit('isInNetwork', false)}
                                                    className="mr-2"
                                                />
                                                <span className="text-sm font-medium">Out-of-Network</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Treatment Services */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-lg font-semibold mb-4">Treatment Services</h2>
                                    
                                    <div className="space-y-3">
                                        {services.map(service => (
                                            <div key={service.id} className="border rounded-lg p-4">
                                                <label className="flex items-center cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={service.selected}
                                                        onChange={() => toggleService(service.id)}
                                                        className="mr-3"
                                                    />
                                                    <div className="flex-1">
                                                        <div className="font-medium">{service.fullName}</div>
                                                        <div className="text-sm text-gray-600">{service.name}</div>
                                                    </div>
                                                </label>
                                                
                                                {service.selected && (
                                                    <div className="mt-3 ml-7 grid grid-cols-2 gap-3">
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                                Daily Rate ($)
                                                            </label>
                                                            <input
                                                                type="number"
                                                                className="w-full px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                value={service.dailyRate}
                                                                onChange={(e) => updateService(service.id, 'dailyRate', e.target.value)}
                                                                placeholder="Enter rate"
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">
                                                                Number of Days
                                                            </label>
                                                            <input
                                                                type="number"
                                                                className="w-full px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                value={service.days}
                                                                onChange={(e) => updateService(service.id, 'days', e.target.value)}
                                                            />
                                                        </div>
                                                        {service.dailyRate && service.days && (
                                                            <div className="col-span-2 text-center p-2 bg-blue-50 rounded">
                                                                <span className="text-sm font-semibold text-blue-700">
                                                                    Total: ${(parseFloat(service.dailyRate) * parseInt(service.days)).toLocaleString()}
                                                                </span>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Right Column - Results */}
                            <div>
                                {calculation && calculation.services.length > 0 ? (
                                    <div className="space-y-6">
                                        {/* Main Result */}
                                        <div className="bg-blue-600 text-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Client Responsibility</h3>
                                            <div className="text-center">
                                                <div className="text-4xl font-bold mb-2">
                                                    ${calculation.totalClientCost.toLocaleString()}
                                                </div>
                                                <p className="text-blue-100">Total amount client will pay</p>
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4 mt-6">
                                                <div className="bg-white/20 rounded p-3">
                                                    <div className="text-sm text-blue-100">Insurance Pays</div>
                                                    <div className="text-xl font-semibold">${calculation.insurancePays.toLocaleString()}</div>
                                                </div>
                                                <div className="bg-white/20 rounded p-3">
                                                    <div className="text-sm text-blue-100">Total Charges</div>
                                                    <div className="text-xl font-semibold">${calculation.totalCharges.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Breakdown */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Cost Breakdown</h3>
                                            
                                            {/* Services */}
                                            <div className="mb-6">
                                                <h4 className="text-sm font-medium text-gray-700 mb-2">Selected Services</h4>
                                                {calculation.services.map((service, idx) => (
                                                    <div key={idx} className="flex justify-between py-2 border-b">
                                                        <span className="text-sm">{service.fullName} ({service.days} days)</span>
                                                        <span className="font-medium">${service.totalCost.toLocaleString()}</span>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* Calculations */}
                                            <div className="space-y-2">
                                                <div className="flex justify-between py-2">
                                                    <span className="text-sm">Total Provider Charges</span>
                                                    <span className="font-medium">${calculation.totalCharges.toLocaleString()}</span>
                                                </div>
                                                
                                                {!benefits.isInNetwork && (
                                                    <div className="flex justify-between py-2">
                                                        <span className="text-sm">Allowed Amount (Out-of-Network)</span>
                                                        <span className="font-medium">${calculation.allowedAmount.toLocaleString()}</span>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between py-2 border-t pt-3">
                                                    <span className="text-sm">Deductible Applied</span>
                                                    <span className="font-medium text-red-600">-${calculation.deductibleResponsibility.toLocaleString()}</span>
                                                </div>
                                                
                                                <div className="flex justify-between py-2">
                                                    <span className="text-sm">
                                                        Coinsurance ({calculation.coinsurancePercentage}% patient / {calculation.insuranceCoinsurancePercentage}% insurance)
                                                    </span>
                                                    <span className="font-medium text-red-600">-${calculation.coinsuranceResponsibility.toLocaleString()}</span>
                                                </div>
                                                
                                                {calculation.balanceBilling > 0 && (
                                                    <div className="flex justify-between py-2">
                                                        <span className="text-sm">Balance Billing (Out-of-Network)</span>
                                                        <span className="font-medium text-red-600">-${calculation.balanceBilling.toLocaleString()}</span>
                                                    </div>
                                                )}
                                                
                                                {calculation.oopMaxReached && (
                                                    <div className="bg-green-50 p-3 rounded my-2">
                                                        <p className="text-sm text-green-700 font-medium">
                                                            âœ“ Out-of-Pocket Maximum Reached - Responsibility capped
                                                        </p>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between py-3 border-t font-semibold">
                                                    <span>Total Client Responsibility</span>
                                                    <span className="text-lg text-blue-600">${calculation.totalClientCost.toLocaleString()}</span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Payment Options */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Payment Collection Options</h3>
                                            
                                            <div className="space-y-4">
                                                {/* Option 1 */}
                                                <div className="border-2 border-gray-200 rounded-lg p-4">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-gray-600">Option 1</span>
                                                            <h4 className="font-semibold">Pay Remaining Deductible</h4>
                                                        </div>
                                                        <div className="text-2xl font-bold">
                                                            ${Math.min(calculation.remainingDeductible, calculation.remainingOOP).toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Satisfies deductible requirement. After this, patient pays only {benefits.coinsurance}% coinsurance.
                                                    </p>
                                                </div>

                                                {/* Option 2 */}
                                                <div className="border-2 border-blue-200 bg-blue-50 rounded-lg p-4">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-blue-600">Option 2</span>
                                                            <h4 className="font-semibold">Pay Half OOP Remaining</h4>
                                                        </div>
                                                        <div className="text-2xl font-bold text-blue-700">
                                                            ${(calculation.remainingOOP * 0.5).toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Prepays 50% toward annual maximum. Reduces future collection needs.
                                                    </p>
                                                </div>

                                                {/* Option 3 */}
                                                <div className="border-2 border-green-200 rounded-lg p-4">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-green-600">Option 3</span>
                                                            <h4 className="font-semibold">Pay Full OOP Maximum</h4>
                                                        </div>
                                                        <div className="text-2xl font-bold text-green-700">
                                                            ${calculation.remainingOOP.toLocaleString()}
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Insurance pays 100% for covered services rest of year. Best value for ongoing treatment.
                                                    </p>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Benefits Progress */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Benefits Progress</h3>
                                            
                                            <div className="space-y-4">
                                                <div>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span>Deductible</span>
                                                        <span>${benefits.deductibleMet || 0} / ${benefits.deductible || 0}</span>
                                                    </div>
                                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                                        <div 
                                                            className="bg-blue-600 h-2 rounded-full transition-all"
                                                            style={{width: `${Math.min(100, ((parseFloat(benefits.deductibleMet) || 0) / (parseFloat(benefits.deductible) || 1)) * 100)}%`}}
                                                        />
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span>Out-of-Pocket Maximum</span>
                                                        <span>${benefits.oopMet || 0} / ${benefits.oopMax || 0}</span>
                                                    </div>
                                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                                        <div 
                                                            className="bg-green-600 h-2 rounded-full transition-all"
                                                            style={{width: `${Math.min(100, ((parseFloat(benefits.oopMet) || 0) / (parseFloat(benefits.oopMax) || 1)) * 100)}%`}}
                                                        />
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow p-12 text-center">
                                        <svg className="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">No Calculation Yet</h3>
                                        <p className="text-gray-600">Enter benefits and select services to calculate</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<InsuranceBenefitsCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
