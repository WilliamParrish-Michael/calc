<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Benefits Calculator</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        * { box-sizing: border-box; }
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .collapse-transition {
            transition: all 0.3s ease-in-out;
            overflow: hidden;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function InsuranceBenefitsCalculator() {
            // Insurance Benefits State
            const [benefits, setBenefits] = useState({
                deductible: '',
                deductibleMet: '',
                oopMax: '',
                oopMet: '',
                coinsurance: '',
                isInNetwork: true
            });

            // Services State with default days
            const [services, setServices] = useState([
                { id: 'detox', name: 'Detox', fullName: 'Medical Detoxification', selected: false, dailyRate: '', days: '7' },
                { id: 'residential', name: 'Residential', fullName: 'Residential Treatment', selected: false, dailyRate: '', days: '21' },
                { id: 'php', name: 'PHP', fullName: 'Partial Hospitalization Program', selected: false, dailyRate: '', days: '30' },
                { id: 'iop', name: 'IOP', fullName: 'Intensive Outpatient Program', selected: false, dailyRate: '', days: '30' }
            ]);

            // Calculation state
            const [calculation, setCalculation] = useState(null);
            const [showDetailedBreakdown, setShowDetailedBreakdown] = useState(false);

            // Update benefit field
            const updateBenefit = (field, value) => {
                setBenefits(prev => ({ ...prev, [field]: value }));
            };

            // Toggle service selection
            const toggleService = (serviceId) => {
                setServices(prev => prev.map(service => 
                    service.id === serviceId 
                        ? { ...service, selected: !service.selected }
                        : service
                ));
            };

            // Update service field
            const updateService = (serviceId, field, value) => {
                setServices(prev => prev.map(service => 
                    service.id === serviceId 
                        ? { ...service, [field]: value }
                        : service
                ));
            };

            // Calculate responsibility
            const calculateResponsibility = () => {
                // Get selected services with valid data
                const selectedServices = services.filter(s => 
                    s.selected && s.dailyRate && s.days
                );

                if (selectedServices.length === 0) {
                    setCalculation(null);
                    return;
                }

                // Parse benefit values
                const deductible = parseFloat(benefits.deductible) || 0;
                const deductibleMet = parseFloat(benefits.deductibleMet) || 0;
                const oopMax = parseFloat(benefits.oopMax) || 0;
                const oopMet = parseFloat(benefits.oopMet) || 0;
                const coinsurance = parseFloat(benefits.coinsurance) || 0;

                // Calculate service totals
                const serviceDetails = selectedServices.map(service => ({
                    ...service,
                    totalCost: parseFloat(service.dailyRate) * parseInt(service.days)
                }));

                const totalCharges = serviceDetails.reduce((sum, s) => sum + s.totalCost, 0);
                const allowedAmount = benefits.isInNetwork ? totalCharges : totalCharges * 0.8;

                // Calculate remaining benefits
                const remainingDeductible = Math.max(0, deductible - deductibleMet);
                const remainingOOP = Math.max(0, oopMax - oopMet);

                // Track running totals for per-service calculations
                let runningDeductibleUsed = 0;
                let runningOOPUsed = 0;
                let runningRemainingDeductible = remainingDeductible;
                let runningRemainingOOP = remainingOOP;
                let totalClientResponsibilityPaid = 0;
                let daysToPayOffResponsibility = 0;

                // Calculate per-service breakdown
                const servicesWithBreakdown = serviceDetails.map(service => {
                    const serviceAllowed = benefits.isInNetwork ? service.totalCost : service.totalCost * 0.8;
                    
                    // Calculate deductible for this service
                    const serviceDeductible = Math.min(serviceAllowed, runningRemainingDeductible);
                    runningRemainingDeductible -= serviceDeductible;
                    
                    // Calculate coinsurance for this service
                    const serviceAfterDeductible = serviceAllowed - serviceDeductible;
                    const serviceCoinsurance = serviceAfterDeductible * (coinsurance / 100);
                    
                    // Total theoretical responsibility for this service
                    const serviceTheoreticalResponsibility = serviceDeductible + serviceCoinsurance;
                    
                    // Apply OOP max
                    const serviceActualResponsibility = Math.min(serviceTheoreticalResponsibility, runningRemainingOOP);
                    runningRemainingOOP -= serviceActualResponsibility;
                    
                    // Balance billing for this service
                    const serviceBalanceBilling = !benefits.isInNetwork ? service.totalCost - serviceAllowed : 0;
                    
                    // Insurance pays
                    const serviceInsurancePays = serviceAllowed - serviceActualResponsibility;
                    
                    // Daily rates
                    const clientDailyRate = (serviceActualResponsibility + serviceBalanceBilling) / parseInt(service.days);
                    const insuranceDailyRate = serviceInsurancePays / parseInt(service.days);
                    
                    // Track total client responsibility
                    totalClientResponsibilityPaid += serviceActualResponsibility + serviceBalanceBilling;
                    
                    return {
                        ...service,
                        clientResponsibility: serviceActualResponsibility + serviceBalanceBilling,
                        insurancePays: serviceInsurancePays,
                        clientDailyRate,
                        insuranceDailyRate,
                        deductibleUsed: serviceDeductible,
                        coinsuranceAmount: serviceActualResponsibility - serviceDeductible,
                        balanceBilling: serviceBalanceBilling
                    };
                });

                // Calculate totals
                const totalClientCost = servicesWithBreakdown.reduce((sum, s) => sum + s.clientResponsibility, 0);
                const totalInsurancePays = servicesWithBreakdown.reduce((sum, s) => sum + s.insurancePays, 0);
                const totalDeductibleUsed = servicesWithBreakdown.reduce((sum, s) => sum + s.deductibleUsed, 0);
                const totalCoinsuranceUsed = servicesWithBreakdown.reduce((sum, s) => sum + s.coinsuranceAmount, 0);
                const totalBalanceBilling = servicesWithBreakdown.reduce((sum, s) => sum + s.balanceBilling, 0);

                // Calculate days until 100% coverage
                const daysToFullCoverage = calculateDaysToFullCoverage(
                    servicesWithBreakdown,
                    remainingOOP,
                    remainingDeductible,
                    coinsurance
                );

                // Calculate days until client responsibility is met
                const calculateDaysToPayResponsibility = (services, totalClientCost) => {
                    if (totalClientCost <= 0) return { totalDays: 0, breakdown: [] };
                    
                    // Calculate weighted average daily rate
                    const totalDays = services.reduce((sum, s) => sum + parseInt(s.days), 0);
                    const weightedDailyRate = services.reduce((sum, s) => sum + (s.clientDailyRate * parseInt(s.days)), 0) / totalDays;
                    
                    // Calculate days needed
                    const daysNeeded = Math.ceil(totalClientCost / weightedDailyRate);
                    
                    // Create breakdown by service type
                    const breakdown = services.map(service => ({
                        name: service.fullName,
                        dailyRate: service.clientDailyRate,
                        daysToPayOff: Math.ceil(totalClientCost / service.clientDailyRate),
                        percentOfTotal: ((service.clientResponsibility / totalClientCost) * 100).toFixed(1)
                    }));
                    
                    return {
                        totalDays: daysNeeded,
                        weightedDailyRate,
                        breakdown
                    };
                };

                const daysToPayResponsibility = calculateDaysToPayResponsibility(servicesWithBreakdown, totalClientCost);

                setCalculation({
                    services: servicesWithBreakdown,
                    totalCharges,
                    allowedAmount,
                    totalDeductibleUsed,
                    totalCoinsuranceUsed,
                    totalBalanceBilling,
                    totalInsurancePays,
                    totalClientCost,
                    remainingDeductible: Math.max(0, remainingDeductible - totalDeductibleUsed),
                    remainingOOP: Math.max(0, remainingOOP - (totalDeductibleUsed + totalCoinsuranceUsed)),
                    oopMaxReached: runningRemainingOOP === 0 && remainingOOP > 0,
                    coinsurancePercentage: coinsurance,
                    insuranceCoinsurancePercentage: 100 - coinsurance,
                    daysToFullCoverage,
                    daysToPayResponsibility,
                    hasDeductible: deductible > 0
                });
            };

            // Calculate days until 100% coverage
            const calculateDaysToFullCoverage = (services, remainingOOP, remainingDeductible, coinsurance) => {
                if (remainingOOP <= 0) return 0;
                
                // Calculate average daily cost across all services
                const totalDays = services.reduce((sum, s) => sum + parseInt(s.days), 0);
                const avgDailyRate = services.reduce((sum, s) => sum + s.totalCost, 0) / totalDays;
                
                // Calculate how much needs to be paid to reach OOP max
                let amountToOOPMax = remainingOOP;
                
                // Simple calculation: days = amount needed / daily responsibility
                // This is approximate since it depends on deductible/coinsurance split
                let estimatedDays;
                if (remainingDeductible > 0) {
                    // Still in deductible phase - pay 100%
                    const daysInDeductible = Math.min(remainingDeductible / avgDailyRate, amountToOOPMax / avgDailyRate);
                    const remainingAfterDeductible = amountToOOPMax - (daysInDeductible * avgDailyRate);
                    const daysInCoinsurance = remainingAfterDeductible / (avgDailyRate * (coinsurance / 100));
                    estimatedDays = daysInDeductible + daysInCoinsurance;
                } else {
                    // Only coinsurance phase
                    estimatedDays = amountToOOPMax / (avgDailyRate * (coinsurance / 100));
                }
                
                return Math.ceil(estimatedDays);
            };

            // Recalculate when inputs change
            useEffect(() => {
                calculateResponsibility();
            }, [benefits, services]);

            return (
                <div className="min-h-screen bg-gray-50 p-4">
                    <div className="max-w-7xl mx-auto">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow p-6 mb-6">
                            <h1 className="text-2xl font-bold text-gray-800">Insurance Benefits Calculator</h1>
                            <p className="text-gray-600 mt-1">Calculate client responsibility for treatment services</p>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Left Column - Inputs */}
                            <div className="space-y-6">
                                {/* Insurance Benefits */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-lg font-semibold mb-4">Insurance Benefits</h2>
                                    
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Annual Deductible ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.deductible}
                                                    onChange={(e) => updateBenefit('deductible', e.target.value)}
                                                    placeholder="5000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Deductible Met ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.deductibleMet}
                                                    onChange={(e) => updateBenefit('deductibleMet', e.target.value)}
                                                    placeholder="1500"
                                                />
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    Out-of-Pocket Max ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.oopMax}
                                                    onChange={(e) => updateBenefit('oopMax', e.target.value)}
                                                    placeholder="8000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">
                                                    OOP Met ($)
                                                </label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.oopMet}
                                                    onChange={(e) => updateBenefit('oopMet', e.target.value)}
                                                    placeholder="2000"
                                                />
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">
                                                Coinsurance (Patient %)
                                            </label>
                                            <div className="flex items-center space-x-2">
                                                <input
                                                    type="number"
                                                    min="0"
                                                    max="100"
                                                    className="w-24 px-3 py-2 border rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                    value={benefits.coinsurance}
                                                    onChange={(e) => updateBenefit('coinsurance', e.target.value)}
                                                    placeholder="20"
                                                />
                                                <span className="text-sm text-gray-600">%</span>
                                                {benefits.coinsurance && (
                                                    <span className="text-sm text-gray-600 ml-4">
                                                        (Insurance pays: {100 - parseFloat(benefits.coinsurance)}%)
                                                    </span>
                                                )}
                                            </div>
                                        </div>

                                        <div className="flex items-center space-x-6">
                                            <label className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    checked={benefits.isInNetwork}
                                                    onChange={() => updateBenefit('isInNetwork', true)}
                                                    className="mr-2"
                                                />
                                                <span className="text-sm font-medium">In-Network</span>
                                            </label>
                                            <label className="flex items-center cursor-pointer">
                                                <input
                                                    type="radio"
                                                    checked={!benefits.isInNetwork}
                                                    onChange={() => updateBenefit('isInNetwork', false)}
                                                    className="mr-2"
                                                />
                                                <span className="text-sm font-medium">Out-of-Network</span>
                                            </label>
                                        </div>
                                    </div>
                                </div>

                                {/* Treatment Services */}
                                <div className="bg-white rounded-lg shadow p-6">
                                    <h2 className="text-lg font-semibold mb-4">Treatment Services</h2>
                                    
                                    <div className="space-y-3">
                                        {services.map(service => {
                                            const serviceCalc = calculation?.services.find(s => s.id === service.id);
                                            
                                            return (
                                                <div key={service.id} className="border rounded-lg p-4">
                                                    <label className="flex items-center cursor-pointer">
                                                        <input
                                                            type="checkbox"
                                                            checked={service.selected}
                                                            onChange={() => toggleService(service.id)}
                                                            className="mr-3"
                                                        />
                                                        <div className="flex-1">
                                                            <div className="font-medium">{service.fullName}</div>
                                                            <div className="text-sm text-gray-600">{service.name}</div>
                                                        </div>
                                                    </label>
                                                    
                                                    {service.selected && (
                                                        <div className="mt-3 ml-7">
                                                            <div className="grid grid-cols-2 gap-3">
                                                                <div>
                                                                    <label className="block text-xs font-medium text-gray-700 mb-1">
                                                                        Daily Rate ($)
                                                                    </label>
                                                                    <input
                                                                        type="number"
                                                                        className="w-full px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                        value={service.dailyRate}
                                                                        onChange={(e) => updateService(service.id, 'dailyRate', e.target.value)}
                                                                        placeholder="Enter rate"
                                                                    />
                                                                </div>
                                                                <div>
                                                                    <label className="block text-xs font-medium text-gray-700 mb-1">
                                                                        Number of Days
                                                                    </label>
                                                                    <input
                                                                        type="number"
                                                                        className="w-full px-2 py-1 border rounded focus:outline-none focus:ring-2 focus:ring-blue-500"
                                                                        value={service.days}
                                                                        onChange={(e) => updateService(service.id, 'days', e.target.value)}
                                                                    />
                                                                </div>
                                                            </div>
                                                            
                                                            {service.dailyRate && service.days && (
                                                                <div className="mt-3 space-y-2">
                                                                    <div className="p-2 bg-blue-50 rounded">
                                                                        <div className="text-sm font-semibold text-blue-700">
                                                                            Service Total: ${(parseFloat(service.dailyRate) * parseInt(service.days)).toLocaleString()}
                                                                        </div>
                                                                    </div>
                                                                    
                                                                    {serviceCalc && (
                                                                        <div className="grid grid-cols-2 gap-2 text-xs">
                                                                            <div className="p-2 bg-red-50 rounded">
                                                                                <div className="font-medium text-red-700">Client Pays</div>
                                                                                <div>Total: ${serviceCalc.clientResponsibility.toFixed(2)}</div>
                                                                                <div>Daily: ${serviceCalc.clientDailyRate.toFixed(2)}</div>
                                                                            </div>
                                                                            <div className="p-2 bg-green-50 rounded">
                                                                                <div className="font-medium text-green-700">Insurance Pays</div>
                                                                                <div>Total: ${serviceCalc.insurancePays.toFixed(2)}</div>
                                                                                <div>Daily: ${serviceCalc.insuranceDailyRate.toFixed(2)}</div>
                                                                            </div>
                                                                        </div>
                                                                    )}
                                                                </div>
                                                            )}
                                                        </div>
                                                    )}
                                                </div>
                                            );
                                        })}
                                    </div>
                                </div>
                            </div>

                            {/* Right Column - Results */}
                            <div>
                                {calculation && calculation.services.length > 0 ? (
                                    <div className="space-y-6">
                                        {/* Main Result */}
                                        <div className="bg-blue-600 text-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Client Responsibility</h3>
                                            <div className="text-center">
                                                <div className="text-4xl font-bold mb-2">
                                                    ${calculation.totalClientCost.toLocaleString()}
                                                </div>
                                                <p className="text-blue-100">Total amount client will pay</p>
                                                
                                                {calculation.daysToPayResponsibility && calculation.daysToPayResponsibility.totalDays > 0 && (
                                                    <div className="mt-4 p-3 bg-white/20 rounded">
                                                        <p className="text-sm font-medium">
                                                            Days to pay off responsibility: {calculation.daysToPayResponsibility.totalDays} days
                                                        </p>
                                                        <p className="text-xs text-blue-100 mt-1">
                                                            Based on weighted average daily rate: ${calculation.daysToPayResponsibility.weightedDailyRate.toFixed(2)}/day
                                                        </p>
                                                    </div>
                                                )}
                                                
                                                {calculation.daysToFullCoverage > 0 && (
                                                    <div className="mt-3 p-3 bg-white/10 rounded">
                                                        <p className="text-xs text-blue-100">
                                                            Days until 100% insurance coverage: {calculation.daysToFullCoverage} days
                                                        </p>
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4 mt-6">
                                                <div className="bg-white/20 rounded p-3">
                                                    <div className="text-sm text-blue-100">Insurance Pays</div>
                                                    <div className="text-xl font-semibold">${calculation.totalInsurancePays.toLocaleString()}</div>
                                                </div>
                                                <div className="bg-white/20 rounded p-3">
                                                    <div className="text-sm text-blue-100">Total Charges</div>
                                                    <div className="text-xl font-semibold">${calculation.totalCharges.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Payment Collection Options */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Payment Collection Options</h3>
                                            
                                            <div className="space-y-4">
                                                {/* Option 1 - Emergency */}
                                                <div className="border-2 border-red-200 rounded-lg p-4 bg-red-50">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-red-600">Option 1 - Emergency</span>
                                                            <h4 className="font-semibold">Minimum Payment Required</h4>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-red-700">
                                                                ${Math.min(calculation.totalClientCost * 0.1, 500).toFixed(2)}
                                                            </div>
                                                            <div className="text-xs text-red-600">10% of total or $500 (whichever is less)</div>
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Emergency payment option for financial hardship cases.
                                                    </p>
                                                </div>

                                                {/* Option 2 - Deductible or Hardship */}
                                                {calculation.totalDeductibleUsed > 0 ? (
                                                    <div className="border-2 border-orange-200 rounded-lg p-4 bg-orange-50">
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <span className="text-sm font-semibold text-orange-600">Option 2 - Deductible</span>
                                                                <h4 className="font-semibold">Pay Deductible Portion</h4>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className="text-2xl font-bold text-orange-700">
                                                                    ${calculation.totalDeductibleUsed.toFixed(2)}
                                                                </div>
                                                                <div className="text-xs text-orange-600">Deductible applied to services</div>
                                                            </div>
                                                        </div>
                                                        <p className="text-sm text-gray-600 mt-2">
                                                            Covers the deductible portion of these services. After deductible, patient pays only {calculation.coinsurancePercentage}% coinsurance.
                                                        </p>
                                                    </div>
                                                ) : (
                                                    <div className="border-2 border-yellow-200 rounded-lg p-4 bg-yellow-50">
                                                        <div className="flex justify-between items-start">
                                                            <div>
                                                                <span className="text-sm font-semibold text-yellow-700">Option 2 - Hardship</span>
                                                                <h4 className="font-semibold">Financial Hardship Payment</h4>
                                                            </div>
                                                            <div className="text-right">
                                                                <div className="text-2xl font-bold text-yellow-700">
                                                                    ${(calculation.totalClientCost * 0.25).toFixed(2)}
                                                                </div>
                                                                <div className="text-xs text-yellow-600">25% of total responsibility</div>
                                                            </div>
                                                        </div>
                                                        <p className="text-sm text-gray-600 mt-2">
                                                            Reduced payment option for financial hardship situations.
                                                        </p>
                                                    </div>
                                                )}

                                                {/* Option 3 - 50% Responsibility */}
                                                <div className="border-2 border-blue-200 bg-blue-50 rounded-lg p-4">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-blue-600">Option 3 - Standard</span>
                                                            <h4 className="font-semibold">Pay 50% of Responsibility</h4>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-blue-700">
                                                                ${(calculation.totalClientCost * 0.5).toFixed(2)}
                                                            </div>
                                                            <div className="text-xs text-blue-600">Half of total responsibility</div>
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Standard payment option. Remaining balance can be billed or payment plan arranged.
                                                    </p>
                                                </div>

                                                {/* Option 4 - 100% Responsibility */}
                                                <div className="border-2 border-green-200 rounded-lg p-4 bg-green-50">
                                                    <div className="flex justify-between items-start">
                                                        <div>
                                                            <span className="text-sm font-semibold text-green-600">Option 4 - Full Payment</span>
                                                            <h4 className="font-semibold">Pay 100% of Responsibility</h4>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-green-700">
                                                                ${calculation.totalClientCost.toFixed(2)}
                                                            </div>
                                                            <div className="text-xs text-green-600">Complete payment</div>
                                                        </div>
                                                    </div>
                                                    <p className="text-sm text-gray-600 mt-2">
                                                        Full payment of all client responsibility. No remaining balance.
                                                    </p>
                                                </div>
                                            </div>

                                            {/* Payment Summary */}
                                            <div className="mt-4 p-3 bg-gray-100 rounded">
                                                <div className="flex justify-between items-center">
                                                    <span className="text-sm font-medium">Client Total Responsibility:</span>
                                                    <span className="font-bold">${calculation.totalClientCost.toFixed(2)}</span>
                                                </div>
                                                <div className="flex justify-between items-center mt-1">
                                                    <span className="text-sm font-medium">Insurance Total Payment:</span>
                                                    <span className="font-bold text-green-600">${calculation.totalInsurancePays.toFixed(2)}</span>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Basic Breakdown */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <div className="flex justify-between items-center mb-4">
                                                <h3 className="text-lg font-semibold">Cost Breakdown</h3>
                                                <button
                                                    onClick={() => setShowDetailedBreakdown(!showDetailedBreakdown)}
                                                    className="text-sm text-blue-600 hover:text-blue-700 font-medium"
                                                >
                                                    {showDetailedBreakdown ? 'Hide' : 'Show'} Detailed Breakdown
                                                </button>
                                            </div>
                                            
                                            {/* Services Summary */}
                                            <div className="mb-6">
                                                <h4 className="text-sm font-medium text-gray-700 mb-2">Selected Services</h4>
                                                {calculation.services.map((service, idx) => (
                                                    <div key={idx} className="flex justify-between py-2 border-b">
                                                        <span className="text-sm">{service.fullName} ({service.days} days)</span>
                                                        <span className="font-medium">${service.totalCost.toLocaleString()}</span>
                                                    </div>
                                                ))}
                                            </div>

                                            {/* Basic Calculations */}
                                            <div className="space-y-2">
                                                <div className="flex justify-between py-2">
                                                    <span className="text-sm">Total Provider Charges</span>
                                                    <span className="font-medium">${calculation.totalCharges.toLocaleString()}</span>
                                                </div>
                                                
                                                {!benefits.isInNetwork && (
                                                    <div className="flex justify-between py-2">
                                                        <span className="text-sm">Allowed Amount (Out-of-Network)</span>
                                                        <span className="font-medium">${calculation.allowedAmount.toLocaleString()}</span>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between py-2 border-t pt-3">
                                                    <span className="text-sm">Deductible Applied</span>
                                                    <span className="font-medium text-red-600">-${calculation.totalDeductibleUsed.toFixed(2)}</span>
                                                </div>
                                                
                                                <div className="flex justify-between py-2">
                                                    <span className="text-sm">
                                                        Coinsurance ({calculation.coinsurancePercentage}% patient / {calculation.insuranceCoinsurancePercentage}% insurance)
                                                    </span>
                                                    <span className="font-medium text-red-600">-${calculation.totalCoinsuranceUsed.toFixed(2)}</span>
                                                </div>
                                                
                                                {calculation.totalBalanceBilling > 0 && (
                                                    <div className="flex justify-between py-2">
                                                        <span className="text-sm">Balance Billing (Out-of-Network)</span>
                                                        <span className="font-medium text-red-600">-${calculation.totalBalanceBilling.toFixed(2)}</span>
                                                    </div>
                                                )}
                                                
                                                {calculation.oopMaxReached && (
                                                    <div className="bg-green-50 p-3 rounded my-2">
                                                        <p className="text-sm text-green-700 font-medium">
                                                            ✓ Out-of-Pocket Maximum Reached - Responsibility capped
                                                        </p>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between py-3 border-t font-semibold">
                                                    <span>Total Client Responsibility</span>
                                                    <span className="text-lg text-blue-600">${calculation.totalClientCost.toFixed(2)}</span>
                                                </div>
                                            </div>

                                            {/* Detailed Breakdown - Collapsible */}
                                            {showDetailedBreakdown && (
                                                <div className="mt-6 pt-6 border-t">
                                                    <h4 className="text-sm font-semibold text-gray-700 mb-4">Detailed Service-by-Service Breakdown</h4>
                                                    
                                                    {calculation.services.map((service, idx) => (
                                                        <div key={idx} className="mb-6 p-4 bg-gray-50 rounded">
                                                            <h5 className="font-medium text-gray-800 mb-3">{service.fullName}</h5>
                                                            
                                                            <div className="grid grid-cols-2 gap-4 text-sm">
                                                                <div>
                                                                    <div className="space-y-1">
                                                                        <div className="flex justify-between">
                                                                            <span className="text-gray-600">Service Charges:</span>
                                                                            <span className="font-medium">${service.totalCost.toFixed(2)}</span>
                                                                        </div>
                                                                        <div className="flex justify-between">
                                                                            <span className="text-gray-600">Days:</span>
                                                                            <span className="font-medium">{service.days}</span>
                                                                        </div>
                                                                        <div className="flex justify-between">
                                                                            <span className="text-gray-600">Daily Rate:</span>
                                                                            <span className="font-medium">${service.dailyRate}</span>
                                                                        </div>
                                                                    </div>
                                                                </div>
                                                                
                                                                <div>
                                                                    <div className="space-y-1">
                                                                        <div className="flex justify-between">
                                                                            <span className="text-gray-600">Deductible Used:</span>
                                                                            <span className="font-medium">${service.deductibleUsed.toFixed(2)}</span>
                                                                        </div>
                                                                        <div className="flex justify-between">
                                                                            <span className="text-gray-600">Coinsurance:</span>
                                                                            <span className="font-medium">${service.coinsuranceAmount.toFixed(2)}</span>
                                                                        </div>
                                                                        {service.balanceBilling > 0 && (
                                                                            <div className="flex justify-between">
                                                                                <span className="text-gray-600">Balance Bill:</span>
                                                                                <span className="font-medium">${service.balanceBilling.toFixed(2)}</span>
                                                                            </div>
                                                                        )}
                                                                    </div>
                                                                </div>
                                                            </div>
                                                            
                                                            <div className="mt-3 pt-3 border-t grid grid-cols-2 gap-4">
                                                                <div className="bg-red-100 p-2 rounded">
                                                                    <div className="text-xs font-medium text-red-700">Client Responsibility</div>
                                                                    <div className="text-sm font-bold text-red-800">${service.clientResponsibility.toFixed(2)}</div>
                                                                    <div className="text-xs text-red-600">Daily: ${service.clientDailyRate.toFixed(2)}</div>
                                                                </div>
                                                                <div className="bg-green-100 p-2 rounded">
                                                                    <div className="text-xs font-medium text-green-700">Insurance Pays</div>
                                                                    <div className="text-sm font-bold text-green-800">${service.insurancePays.toFixed(2)}</div>
                                                                    <div className="text-xs text-green-600">Daily: ${service.insuranceDailyRate.toFixed(2)}</div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    ))}
                                                    
                                                    {/* Benefit Progression */}
                                                    <div className="mt-4 p-4 bg-blue-50 rounded">
                                                        <h5 className="font-medium text-blue-800 mb-2">Benefit Usage Progression</h5>
                                                        <div className="text-sm space-y-1">
                                                            <div>• Services are calculated in the order listed above</div>
                                                            <div>• Deductible is applied first to each service until met</div>
                                                            <div>• Then coinsurance applies at {calculation.coinsurancePercentage}% patient / {calculation.insuranceCoinsurancePercentage}% insurance</div>
                                                            <div>• All payments count toward out-of-pocket maximum</div>
                                                            <div>• Once OOP max is reached, insurance pays 100% of allowed charges</div>
                                                        </div>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        {/* Benefits Progress */}
                                        <div className="bg-white rounded-lg shadow p-6">
                                            <h3 className="text-lg font-semibold mb-4">Benefits Progress</h3>
                                            
                                            <div className="space-y-4">
                                                <div>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span>Deductible</span>
                                                        <span>${benefits.deductibleMet || 0} / ${benefits.deductible || 0}</span>
                                                    </div>
                                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                                        <div 
                                                            className="bg-blue-600 h-2 rounded-full transition-all"
                                                            style={{width: `${Math.min(100, ((parseFloat(benefits.deductibleMet) || 0) / (parseFloat(benefits.deductible) || 1)) * 100)}%`}}
                                                        />
                                                    </div>
                                                    <div className="text-xs text-gray-600 mt-1">
                                                        Remaining: ${calculation.remainingDeductible.toFixed(2)}
                                                    </div>
                                                </div>
                                                
                                                <div>
                                                    <div className="flex justify-between text-sm mb-1">
                                                        <span>Out-of-Pocket Maximum</span>
                                                        <span>${benefits.oopMet || 0} / ${benefits.oopMax || 0}</span>
                                                    </div>
                                                    <div className="w-full bg-gray-200 rounded-full h-2">
                                                        <div 
                                                            className="bg-green-600 h-2 rounded-full transition-all"
                                                            style={{width: `${Math.min(100, ((parseFloat(benefits.oopMet) || 0) / (parseFloat(benefits.oopMax) || 1)) * 100)}%`}}
                                                        />
                                                    </div>
                                                    <div className="text-xs text-gray-600 mt-1">
                                                        Remaining: ${calculation.remainingOOP.toFixed(2)}
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            {calculation.daysToFullCoverage > 0 && (
                                                <div className="mt-4 p-3 bg-green-50 rounded">
                                                    <p className="text-sm font-medium text-green-700">
                                                        📅 {calculation.daysToFullCoverage} more days of treatment until 100% insurance coverage
                                                    </p>
                                                    <p className="text-xs text-green-600 mt-1">
                                                        Based on average daily rates of selected services
                                                    </p>
                                                </div>
                                            )}
                                            
                                            {/* Days to Pay Responsibility Breakdown */}
                                            {calculation.daysToPayResponsibility && calculation.daysToPayResponsibility.breakdown.length > 0 && (
                                                <div className="mt-6 p-4 bg-blue-50 rounded-lg">
                                                    <h4 className="text-sm font-semibold text-blue-800 mb-3">Days to Pay Off Total Responsibility</h4>
                                                    
                                                    <div className="bg-white p-3 rounded mb-3">
                                                        <div className="text-center">
                                                            <div className="text-2xl font-bold text-blue-700">
                                                                {calculation.daysToPayResponsibility.totalDays} days
                                                            </div>
                                                            <div className="text-xs text-gray-600">
                                                                Based on weighted average: ${calculation.daysToPayResponsibility.weightedDailyRate.toFixed(2)}/day
                                                            </div>
                                                        </div>
                                                    </div>
                                                    
                                                    <div className="space-y-2">
                                                        <div className="text-xs font-medium text-gray-700 mb-2">Breakdown by Service Type:</div>
                                                        {calculation.daysToPayResponsibility.breakdown.map((service, idx) => (
                                                            <div key={idx} className="bg-gray-50 p-2 rounded text-xs">
                                                                <div className="flex justify-between items-start">
                                                                    <div>
                                                                        <div className="font-medium">{service.name}</div>
                                                                        <div className="text-gray-600">
                                                                            ${calculation.totalClientCost.toFixed(2)} ÷ ${service.dailyRate.toFixed(2)}/day
                                                                        </div>
                                                                    </div>
                                                                    <div className="text-right">
                                                                        <div className="font-bold">{service.daysToPayOff} days</div>
                                                                        <div className="text-gray-600">{service.percentOfTotal}% of total</div>
                                                                    </div>
                                                                </div>
                                                            </div>
                                                        ))}
                                                    </div>
                                                    
                                                    <div className="mt-3 p-2 bg-blue-100 rounded text-xs text-blue-700">
                                                        <strong>Note:</strong> This shows how many days of each service type would be needed to pay the total ${calculation.totalClientCost.toFixed(2)} responsibility.
                                                    </div>
                                                </div>
                                            )}
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow p-12 text-center">
                                        <svg className="w-16 h-16 mx-auto text-gray-400 mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                        </svg>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">No Calculation Yet</h3>
                                        <p className="text-gray-600">Enter benefits and select services to calculate</p>
                                    </div>
                                )}
                            </div>
                        </div>
                    </div>
                </div>
            );
        }

        // Render the app
        ReactDOM.render(<InsuranceBenefitsCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
