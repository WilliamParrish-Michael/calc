<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Insurance Benefits Calculator - Free Tool</title>
    <meta name="description" content="Free insurance benefits calculator to determine client responsibility for treatment services. Calculate deductibles, coinsurance, and out-of-pocket costs.">

    <!-- React and Dependencies -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>

    <style>
        body { margin: 0; font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; }
        .calculator-container { animation: fadeIn 0.5s ease-in; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;

        function InsuranceBenefitsCalculator() {
            const [benefits, setBenefits] = useState({
                deductible: '',
                deductibleMet: '',
                oopMax: '',
                oopMet: '',
                coinsurance: '',
                deductibleCountsTowardOOP: true
            });

            const [services, setServices] = useState({
                detox: { selected: false, dailyRate: '', days: 7 },
                residential: { selected: false, dailyRate: '', days: 21 },
                php: { selected: false, dailyRate: '', days: 30 },
                iop: { selected: false, dailyRate: '', days: 30 }
            });

            const [calculation, setCalculation] = useState(null);

            const serviceInfo = {
                detox: {
                    name: 'Detox',
                    fullName: 'Medical Detoxification',
                    description: 'Medically supervised withdrawal management',
                    defaultRate: 800
                },
                residential: {
                    name: 'Residential',
                    fullName: 'Residential Treatment Center',
                    description: 'Inpatient residential treatment program',
                    defaultRate: 600
                },
                php: {
                    name: 'PHP',
                    fullName: 'Partial Hospitalization Program',
                    description: 'Intensive day treatment program',
                    defaultRate: 400
                },
                iop: {
                    name: 'IOP',
                    fullName: 'Intensive Outpatient Program',
                    description: 'Structured outpatient treatment',
                    defaultRate: 200
                }
            };

            const updateBenefit = (field, value) => {
                // Add validation
                let validatedValue = value;
                
                // Prevent negative numbers
                if (value && parseFloat(value) < 0) {
                    validatedValue = '0';
                }
                
                if (field === 'deductibleMet' || field === 'oopMet') {
                    const max = field === 'deductibleMet' ? parseFloat(benefits.deductible) || 0 : parseFloat(benefits.oopMax) || 0;
                    const numValue = parseFloat(value) || 0;
                    if (numValue > max) {
                        validatedValue = max.toString();
                    }
                }
                
                if (field === 'coinsurance') {
                    const numValue = parseFloat(value) || 0;
                    if (numValue > 100) validatedValue = '100';
                    if (numValue < 0) validatedValue = '0';
                }
                
                setBenefits(prev => ({ ...prev, [field]: validatedValue }));
            };

            const toggleService = (service) => {
                setServices(prev => ({
                    ...prev,
                    [service]: { ...prev[service], selected: !prev[service].selected }
                }));
            };

            const updateService = (service, field, value) => {
                // Add validation for positive numbers
                let validatedValue = value;
                if (field === 'dailyRate' || field === 'days') {
                    const numValue = parseFloat(value) || 0;
                    if (numValue < 0) validatedValue = '0';
                }
                
                setServices(prev => ({
                    ...prev,
                    [service]: { ...prev[service], [field]: validatedValue }
                }));
            };

            const setDefaultRates = () => {
                const newServices = { ...services };
                Object.keys(services).forEach(service => {
                    newServices[service].dailyRate = serviceInfo[service].defaultRate.toString();
                });
                setServices(newServices);
            };

            const resetCalculator = () => {
                setBenefits({
                    deductible: '',
                    deductibleMet: '',
                    oopMax: '',
                    oopMet: '',
                    coinsurance: '',
                    deductibleCountsTowardOOP: true
                });
                setServices({
                    detox: { selected: false, dailyRate: '', days: 7 },
                    residential: { selected: false, dailyRate: '', days: 21 },
                    php: { selected: false, dailyRate: '', days: 30 },
                    iop: { selected: false, dailyRate: '', days: 30 }
                });
                setCalculation(null);
            };

            const calculateResponsibility = () => {
                const selectedServices = Object.entries(services)
                    .filter(([_, service]) => service.selected && service.dailyRate && service.days)
                    .map(([key, service]) => ({
                        name: key,
                        ...service,
                        totalCost: parseFloat(service.dailyRate) * parseInt(service.days)
                    }));

                if (selectedServices.length === 0) {
                    setCalculation(null);
                    return;
                }

                // Basic calculations
                const deductible = parseFloat(benefits.deductible) || 0;
                const deductibleMet = parseFloat(benefits.deductibleMet) || 0;
                const oopMax = parseFloat(benefits.oopMax) || 0;
                const oopMet = parseFloat(benefits.oopMet) || 0;
                const coinsurance = parseFloat(benefits.coinsurance) || 0;
                const coinsuranceDecimal = coinsurance / 100;

                const totalProviderCharges = selectedServices.reduce((sum, service) => sum + service.totalCost, 0);
                const allowedAmount = totalProviderCharges;
                
                const remainingDeductible = Math.max(0, deductible - deductibleMet);
                const remainingOOP = Math.max(0, oopMax - oopMet);
                
                // Calculate theoretical responsibility before OOP max
                const deductibleResponsibility = Math.min(allowedAmount, remainingDeductible);
                const amountAfterDeductible = Math.max(0, allowedAmount - deductibleResponsibility);
                const coinsuranceResponsibility = amountAfterDeductible * coinsuranceDecimal;
                
                // Calculate what counts toward OOP max
                let amountTowardOOP;
                if (benefits.deductibleCountsTowardOOP) {
                    // Both deductible and coinsurance count
                    amountTowardOOP = deductibleResponsibility + coinsuranceResponsibility;
                } else {
                    // Only coinsurance counts
                    amountTowardOOP = coinsuranceResponsibility;
                }
                
                // Apply OOP max cap only to amounts that count
                const cappedOOPAmount = Math.min(amountTowardOOP, remainingOOP);
                
                // Calculate actual amounts paid
                let actualDeductiblePaid = deductibleResponsibility;
                let actualCoinsurancePaid;
                
                if (benefits.deductibleCountsTowardOOP) {
                    // If deductible counts, both are subject to OOP cap
                    if (cappedOOPAmount < deductibleResponsibility) {
                        actualDeductiblePaid = cappedOOPAmount;
                        actualCoinsurancePaid = 0;
                    } else {
                        actualDeductiblePaid = deductibleResponsibility;
                        actualCoinsurancePaid = cappedOOPAmount - deductibleResponsibility;
                    }
                } else {
                    // If deductible doesn't count, client pays full deductible plus capped coinsurance
                    actualDeductiblePaid = deductibleResponsibility;
                    actualCoinsurancePaid = cappedOOPAmount;
                }
                
                const totalClientCost = actualDeductiblePaid + actualCoinsurancePaid;
                const insurancePays = allowedAmount - totalClientCost;

                // SIMPLIFIED: Calculate when insurance pays 100% using user's formula
                let daysUntil100Percent = null;
                let runningDays = 0;
                let runningDeductible = remainingDeductible;
                let runningOOP = remainingOOP;
                
                // Track through services to find when OOP max is reached
                for (let i = 0; i < selectedServices.length; i++) {
                    const service = selectedServices[i];
                    const dailyRate = parseFloat(service.dailyRate);
                    const serviceDays = parseInt(service.days);
                    
                    // Check each day in this service
                    for (let day = 1; day <= serviceDays; day++) {
                        runningDays++;
                        
                        // Calculate client cost for this day
                        let dayClientCost = 0;
                        let dayOOPContribution = 0;
                        
                        if (runningDeductible > 0) {
                            // In deductible phase
                            const deductiblePortion = Math.min(dailyRate, runningDeductible);
                            dayClientCost = deductiblePortion;
                            runningDeductible -= deductiblePortion;
                            
                            // Check if deductible counts toward OOP
                            if (benefits.deductibleCountsTowardOOP) {
                                dayOOPContribution = deductiblePortion;
                            }
                            
                            // If daily rate exceeds deductible portion, apply coinsurance to remainder
                            if (deductiblePortion < dailyRate) {
                                const remainderAfterDeductible = dailyRate - deductiblePortion;
                                const coinsurancePortion = remainderAfterDeductible * coinsuranceDecimal;
                                dayClientCost += coinsurancePortion;
                                dayOOPContribution += coinsurancePortion; // Coinsurance always counts
                            }
                        } else {
                            // In coinsurance phase
                            const coinsurancePortion = dailyRate * coinsuranceDecimal;
                            dayClientCost = coinsurancePortion;
                            dayOOPContribution = coinsurancePortion; // Coinsurance always counts
                        }
                        
                        // Apply OOP contribution
                        if (runningOOP > 0) {
                            const cappedOOPContribution = Math.min(dayOOPContribution, runningOOP);
                            runningOOP -= cappedOOPContribution;
                            
                            // If OOP is capped, adjust client cost for coinsurance portion
                            if (!benefits.deductibleCountsTowardOOP && runningDeductible === 0 && cappedOOPContribution < dayOOPContribution) {
                                dayClientCost = cappedOOPContribution;
                            } else if (benefits.deductibleCountsTowardOOP && cappedOOPContribution < dayOOPContribution) {
                                dayClientCost = cappedOOPContribution;
                            }
                        } else {
                            // OOP max reached - insurance pays 100%
                            if (daysUntil100Percent === null) {
                                daysUntil100Percent = runningDays;
                            }
                            break;
                        }
                    }
                    
                    if (daysUntil100Percent !== null) break;
                }

                // Benefit status after service
                const newDeductibleMet = Math.min(deductible, deductibleMet + actualDeductiblePaid);
                const newRemainingDeductible = Math.max(0, deductible - newDeductibleMet);
                
                let newOOPMet;
                if (benefits.deductibleCountsTowardOOP) {
                    // Both deductible and coinsurance count toward OOP
                    newOOPMet = Math.min(oopMax, oopMet + actualDeductiblePaid + actualCoinsurancePaid);
                } else {
                    // Only coinsurance counts toward OOP
                    newOOPMet = Math.min(oopMax, oopMet + actualCoinsurancePaid);
                }
                const newRemainingOOP = Math.max(0, oopMax - newOOPMet);

                setCalculation({
                    services: selectedServices,
                    daysUntil100Percent: daysUntil100Percent,
                    totals: {
                        providerCharges: totalProviderCharges,
                        allowedAmount: allowedAmount,
                        deductibleApplied: actualDeductiblePaid,
                        coinsuranceAmount: actualCoinsurancePaid,
                        totalClientCost: totalClientCost,
                        insurancePays: insurancePays,
                        remainingDeductible: newRemainingDeductible,
                        remainingOOP: newRemainingOOP,
                        oopMaxReached: newRemainingOOP === 0
                    },
                    currentStatus: {
                        remainingDeductible: remainingDeductible,
                        remainingOOP: remainingOOP
                    }
                });
            };

            useEffect(() => {
                calculateResponsibility();
            }, [benefits, services]);

            return (
                <div className="min-h-screen bg-gray-50 calculator-container">
                    <div className="max-w-6xl mx-auto p-4">
                        {/* Header */}
                        <div className="bg-white rounded-lg shadow-sm p-6 mb-6">
                            <div className="flex items-center justify-between flex-wrap gap-4">
                                <div>
                                    <h1 className="text-2xl font-bold text-gray-800 mb-2">Insurance Benefits Calculator</h1>
                                    <p className="text-gray-600">Calculate client responsibility for treatment services</p>
                                </div>
                                <button
                                    onClick={resetCalculator}
                                    className="px-4 py-2 text-gray-600 hover:text-gray-800 hover:bg-gray-100 rounded-lg transition-colors"
                                >
                                    Reset Calculator
                                </button>
                            </div>
                        </div>

                        <div className="grid grid-cols-1 lg:grid-cols-2 gap-6">
                            {/* Input Section */}
                            <div className="space-y-6">
                                {/* Benefits Information */}
                                <div className="bg-white rounded-lg shadow-sm p-6">
                                    <h2 className="text-lg font-semibold text-gray-800 mb-4">Insurance Benefits</h2>
                                    
                                    <div className="space-y-4">
                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Annual Deductible ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.deductible}
                                                    onChange={(e) => updateBenefit('deductible', e.target.value)}
                                                    placeholder="5000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Deductible Met ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.deductibleMet}
                                                    onChange={(e) => updateBenefit('deductibleMet', e.target.value)}
                                                    placeholder="1500"
                                                />
                                                {parseFloat(benefits.deductibleMet) > parseFloat(benefits.deductible) && benefits.deductible && (
                                                    <p className="text-xs text-red-600 mt-1">Cannot exceed deductible</p>
                                                )}
                                            </div>
                                        </div>

                                        <div className="grid grid-cols-1 sm:grid-cols-2 gap-4">
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">Out-of-Pocket Max ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.oopMax}
                                                    onChange={(e) => updateBenefit('oopMax', e.target.value)}
                                                    placeholder="8000"
                                                />
                                            </div>
                                            <div>
                                                <label className="block text-sm font-medium text-gray-700 mb-1">OOP Met ($)</label>
                                                <input
                                                    type="number"
                                                    className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                    value={benefits.oopMet}
                                                    onChange={(e) => updateBenefit('oopMet', e.target.value)}
                                                    placeholder="2000"
                                                />
                                                {parseFloat(benefits.oopMet) > parseFloat(benefits.oopMax) && benefits.oopMax && (
                                                    <p className="text-xs text-red-600 mt-1">Cannot exceed OOP max</p>
                                                )}
                                            </div>
                                        </div>

                                        <div>
                                            <label className="block text-sm font-medium text-gray-700 mb-1">Coinsurance (%)</label>
                                            <input
                                                type="number"
                                                min="0"
                                                max="100"
                                                className="w-full px-3 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-blue-500 focus:border-transparent"
                                                value={benefits.coinsurance}
                                                onChange={(e) => updateBenefit('coinsurance', e.target.value)}
                                                placeholder="20"
                                            />
                                        </div>

                                        <div className="pt-2">
                                            <label className="flex items-center cursor-pointer">
                                                <input
                                                    type="checkbox"
                                                    checked={benefits.deductibleCountsTowardOOP}
                                                    onChange={(e) => updateBenefit('deductibleCountsTowardOOP', e.target.checked)}
                                                    className="h-4 w-4 text-blue-600 rounded"
                                                />
                                                <span className="ml-2 text-sm font-medium text-gray-700">Deductible counts toward Out-of-Pocket Maximum</span>
                                            </label>
                                            <p className="text-xs text-gray-500 mt-1 ml-6">
                                                Some plans have deductibles that don't count toward the OOP max
                                            </p>
                                        </div>
                                    </div>
                                </div>

                                {/* Treatment Services */}
                                <div className="bg-white rounded-lg shadow-sm p-6">
                                    <div className="flex items-center justify-between mb-4">
                                        <h2 className="text-lg font-semibold text-gray-800">Treatment Services</h2>
                                        <button
                                            onClick={setDefaultRates}
                                            className="text-sm text-blue-600 hover:text-blue-700 font-medium"
                                        >
                                            Set Default Rates
                                        </button>
                                    </div>

                                    <div className="space-y-3">
                                        {Object.entries(serviceInfo).map(([key, info]) => (
                                            <div 
                                                key={key} 
                                                className={`border rounded-lg p-4 transition-all ${
                                                    services[key].selected 
                                                        ? 'border-blue-300 bg-blue-50' 
                                                        : 'border-gray-200 hover:border-gray-300'
                                                }`}
                                            >
                                                <label className="flex items-start cursor-pointer">
                                                    <input
                                                        type="checkbox"
                                                        checked={services[key].selected}
                                                        onChange={() => toggleService(key)}
                                                        className="h-4 w-4 text-blue-600 rounded mt-1"
                                                    />
                                                    <div className="ml-3 flex-1">
                                                        <div className="font-medium text-gray-800">{info.fullName}</div>
                                                        <div className="text-sm text-gray-600">{info.description}</div>
                                                    </div>
                                                </label>

                                                {services[key].selected && (
                                                    <div className="ml-7 mt-3 grid grid-cols-2 gap-3">
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Daily Rate ($)</label>
                                                            <input
                                                                type="number"
                                                                className="w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                                value={services[key].dailyRate}
                                                                onChange={(e) => updateService(key, 'dailyRate', e.target.value)}
                                                                placeholder={info.defaultRate.toString()}
                                                            />
                                                        </div>
                                                        <div>
                                                            <label className="block text-xs font-medium text-gray-700 mb-1">Number of Days</label>
                                                            <input
                                                                type="number"
                                                                min="1"
                                                                className="w-full px-2 py-1.5 border border-gray-300 rounded focus:ring-2 focus:ring-blue-500 focus:border-transparent text-sm"
                                                                value={services[key].days}
                                                                onChange={(e) => updateService(key, 'days', e.target.value)}
                                                            />
                                                        </div>
                                                        {services[key].dailyRate && services[key].days && (
                                                            <div className="col-span-2 text-center p-2 bg-white rounded border border-blue-200">
                                                                <span className="text-sm text-gray-600">Service Total: </span>
                                                                <span className="font-semibold text-blue-600">
                                                                    ${(parseFloat(services[key].dailyRate) * parseInt(services[key].days)).toLocaleString()}
                                                                </span>
                                                            </div>
                                                        )}
                                                    </div>
                                                )}
                                            </div>
                                        ))}
                                    </div>
                                </div>
                            </div>

                            {/* Results Section */}
                            <div>
                                {calculation && calculation.services.length > 0 ? (
                                    <div className="space-y-6">
                                        {/* Insurance Rules - Simple */}
                                        <div className="bg-gray-50 rounded-lg p-4">
                                            <div className="text-sm text-gray-700 space-y-1">
                                                <div>• Until Deductible: Client pays 100%</div>
                                                <div>• After Deductible: Client pays coinsurance {benefits.coinsurance || '[enter %]'}%</div>
                                                <div>• After OOP Max: Insurance pays 100%</div>
                                                {!benefits.deductibleCountsTowardOOP && (
                                                    <div className="text-amber-600 font-semibold">⚠️ Deductible does NOT count toward OOP max</div>
                                                )}
                                            </div>
                                        </div>
                                        
                                        {!benefits.deductibleCountsTowardOOP && parseFloat(benefits.deductible) > 0 && (
                                            <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                                <div className="flex items-start">
                                                    <svg className="w-5 h-5 text-amber-600 mt-0.5 mr-2 flex-shrink-0" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                        <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
                                                    </svg>
                                                    <div>
                                                        <p className="font-semibold text-amber-800 text-sm">Important: Deductible Doesn't Count Toward OOP Maximum</p>
                                                        <p className="text-sm text-amber-700 mt-1">
                                                            The client must pay the full ${(parseFloat(benefits.deductible) || 0).toLocaleString()} deductible PLUS up to ${(parseFloat(benefits.oopMax) || 0).toLocaleString()} in coinsurance before insurance pays 100%.
                                                            Total possible cost: ${((parseFloat(benefits.deductible) || 0) + (parseFloat(benefits.oopMax) || 0)).toLocaleString()}
                                                        </p>
                                                    </div>
                                                </div>
                                            </div>
                                        )}

                                        {/* Main Result */}
                                        <div className="bg-gradient-to-br from-blue-500 to-blue-600 rounded-lg shadow-sm p-6 text-white">
                                            <h3 className="text-lg font-semibold mb-4">Client Responsibility</h3>
                                            <div className="text-center mb-6">
                                                <div className="text-5xl font-bold mb-2">
                                                    ${calculation.totals.totalClientCost.toLocaleString()}
                                                </div>
                                                <p className="text-blue-100">Total amount client will pay</p>
                                                {calculation.totals.oopMaxReached && (
                                                    <div className="mt-3 bg-white/20 rounded-lg px-4 py-2 text-sm">
                                                        <span className="font-semibold">✓ OOP Max Reached</span> - No more client costs this year
                                                    </div>
                                                )}
                                            </div>
                                            
                                            <div className="grid grid-cols-2 gap-4 text-sm">
                                                <div className="bg-white/10 rounded p-3">
                                                    <div className="text-blue-100">Insurance Pays</div>
                                                    <div className="text-xl font-semibold">${calculation.totals.insurancePays.toLocaleString()}</div>
                                                </div>
                                                <div className="bg-white/10 rounded p-3">
                                                    <div className="text-blue-100">Total Charges</div>
                                                    <div className="text-xl font-semibold">${calculation.totals.providerCharges.toLocaleString()}</div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* When Does Insurance Pay 100%? */}
                                        <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-lg shadow-sm p-6 text-white">
                                            <h3 className="text-lg font-semibold mb-4">📅 When Does Insurance Pay 100%?</h3>
                                            {calculation.currentStatus.remainingOOP === 0 ? (
                                                <div className="text-center">
                                                    <div className="text-4xl font-bold mb-2">
                                                        Already at 100%!
                                                    </div>
                                                    <p className="text-purple-100">OOP Maximum already reached</p>
                                                    <div className="mt-3 bg-white/20 rounded-lg px-4 py-2 text-sm">
                                                        <span className="font-semibold">✓ All covered services are FREE</span>
                                                    </div>
                                                </div>
                                            ) : calculation.daysUntil100Percent ? (
                                                <div className="text-center">
                                                    <div className="text-5xl font-bold mb-2">
                                                        Day {calculation.daysUntil100Percent}
                                                    </div>
                                                    <p className="text-purple-100">Insurance starts paying 100% of covered services</p>
                                                    <div className="mt-3 bg-white/20 rounded-lg px-4 py-2 text-sm">
                                                        <span className="font-semibold">🎉 Out-of-Pocket Maximum will be reached!</span>
                                                    </div>
                                                    <div className="mt-4 p-4 bg-white/20 rounded-lg">
                                                        <p className="text-center text-sm">
                                                            After day {calculation.daysUntil100Percent}, all covered services are FREE for the rest of the year!
                                                        </p>
                                                    </div>
                                                </div>
                                            ) : (
                                                <div className="text-center">
                                                    <div className="text-3xl font-bold mb-2">
                                                        Not reached with current services
                                                    </div>
                                                    <p className="text-purple-100">Need more services to reach OOP maximum</p>
                                                    <div className="mt-3 bg-white/20 rounded-lg px-4 py-2 text-sm">
                                                        <span className="font-semibold">${calculation.currentStatus.remainingOOP.toLocaleString()} remaining to OOP max</span>
                                                    </div>
                                                </div>
                                            )}
                                        </div>

                                        {/* Payment Collection Scenarios */}
                                        <div className="bg-white rounded-lg shadow-sm p-6">
                                            <h4 className="text-lg font-semibold text-gray-800 mb-4">Payment Collection Scenarios</h4>
                                            
                                            <div className="space-y-4">
                                                {/* Scenario 1 - Pay Remaining Deductible */}
                                                <div className="border-2 border-gray-200 rounded-lg p-4 hover:border-blue-300 transition-colors">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-gray-100 text-gray-700 rounded-full text-sm font-semibold mb-2">
                                                                Scenario 1 - Conservative
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay Remaining Deductible</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-gray-800">
                                                                ${Math.min(calculation.currentStatus.remainingDeductible, calculation.totals.totalClientCost).toLocaleString()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-gray-50 p-3 rounded">
                                                            <div className="font-medium mb-1">What This Covers:</div>
                                                            <div className="space-y-1 text-xs">
                                                                <div>• Satisfies remaining deductible requirement</div>
                                                                <div>• After this payment: Client pays only {benefits.coinsurance}% coinsurance</div>
                                                                <div>• Future services much more affordable</div>
                                                                {!benefits.deductibleCountsTowardOOP && calculation.currentStatus.remainingDeductible > 0 && (
                                                                    <div className="text-amber-600">• Note: This payment does NOT reduce OOP remaining</div>
                                                                )}
                                                            </div>
                                                        </div>
                                                        <div className="bg-purple-50 p-3 rounded mt-2">
                                                            <div className="font-medium mb-1 text-purple-800">When Insurance Pays 100%:</div>
                                                            <div className="text-xs">
                                                                {(() => {
                                                                    const paymentAmount = Math.min(calculation.currentStatus.remainingDeductible, calculation.totals.totalClientCost);
                                                                    
                                                                    // Calculate remaining client responsibility after this payment
                                                                    const remainingClientResponsibility = Math.max(0, calculation.totals.totalClientCost - paymentAmount);
                                                                    
                                                                    if (remainingClientResponsibility === 0) {
                                                                        return "Immediately after this payment!";
                                                                    }
                                                                    
                                                                    // Calculate average daily client cost
                                                                    const totalDays = calculation.services.reduce((sum, s) => sum + s.days, 0);
                                                                    const avgClientDailyRate = calculation.totals.totalClientCost / totalDays;
                                                                    
                                                                    // Days needed = remaining responsibility / daily client rate
                                                                    const daysNeeded = Math.ceil(remainingClientResponsibility / avgClientDailyRate);
                                                                    
                                                                    return `After ${daysNeeded} more days of treatment (${remainingClientResponsibility.toLocaleString()} remaining)`;
                                                                })()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Scenario 2 - Pay Half OOP Remaining */}
                                                <div className="border-2 border-blue-200 rounded-lg p-4 hover:border-blue-400 transition-colors bg-blue-50">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-blue-100 text-blue-700 rounded-full text-sm font-semibold mb-2">
                                                                Scenario 2 - Balanced
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay Half of Remaining OOP Maximum</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-blue-700">
                                                                ${(() => {
                                                                    const halfOOP = calculation.currentStatus.remainingOOP * 0.5;
                                                                    if (!benefits.deductibleCountsTowardOOP) {
                                                                        // Pay deductible + half of OOP
                                                                        return Math.min(calculation.currentStatus.remainingDeductible + halfOOP, calculation.totals.totalClientCost).toLocaleString();
                                                                    } else {
                                                                        // Just half of OOP (which includes deductible)
                                                                        return Math.min(halfOOP, calculation.totals.totalClientCost).toLocaleString();
                                                                    }
                                                                })()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-blue-50 p-3 rounded border border-blue-200">
                                                            <div className="font-medium mb-1">What This Covers:</div>
                                                            <div className="space-y-1 text-xs">
                                                                {!benefits.deductibleCountsTowardOOP && calculation.currentStatus.remainingDeductible > 0 && (
                                                                    <div>• Pays remaining deductible: ${calculation.currentStatus.remainingDeductible.toLocaleString()}</div>
                                                                )}
                                                                <div>• Moves halfway to 100% insurance coverage</div>
                                                                <div>• Good for clients likely needing more treatment</div>
                                                            </div>
                                                        </div>
                                                        <div className="bg-purple-50 p-3 rounded mt-2 border border-purple-200">
                                                            <div className="font-medium mb-1 text-purple-800">When Insurance Pays 100%:</div>
                                                            <div className="text-xs">
                                                                {(() => {
                                                                    const halfOOP = calculation.currentStatus.remainingOOP * 0.5;
                                                                    let paymentAmount;
                                                                    
                                                                    if (!benefits.deductibleCountsTowardOOP) {
                                                                        paymentAmount = Math.min(calculation.currentStatus.remainingDeductible + halfOOP, calculation.totals.totalClientCost);
                                                                    } else {
                                                                        paymentAmount = Math.min(halfOOP, calculation.totals.totalClientCost);
                                                                    }
                                                                    
                                                                    // Calculate remaining client responsibility after this payment
                                                                    const remainingClientResponsibility = Math.max(0, calculation.totals.totalClientCost - paymentAmount);
                                                                    
                                                                    if (remainingClientResponsibility === 0) {
                                                                        return "Immediately after this payment!";
                                                                    }
                                                                    
                                                                    // Calculate average daily client cost
                                                                    const totalDays = calculation.services.reduce((sum, s) => sum + s.days, 0);
                                                                    const avgClientDailyRate = calculation.totals.totalClientCost / totalDays;
                                                                    
                                                                    // Days needed = remaining responsibility / daily client rate
                                                                    const daysNeeded = Math.ceil(remainingClientResponsibility / avgClientDailyRate);
                                                                    
                                                                    return `After ${daysNeeded} more days of treatment (${remainingClientResponsibility.toLocaleString()} remaining)`;
                                                                })()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>

                                                {/* Scenario 3 - Pay Full OOP Maximum */}
                                                <div className="border-2 border-green-200 rounded-lg p-4 hover:border-green-400 transition-colors">
                                                    <div className="flex justify-between items-start mb-2">
                                                        <div>
                                                            <span className="inline-block px-3 py-1 bg-green-100 text-green-700 rounded-full text-sm font-semibold mb-2">
                                                                Scenario 3 - Maximum Value
                                                            </span>
                                                            <h5 className="font-semibold text-gray-800">Pay Full Remaining OOP Maximum</h5>
                                                        </div>
                                                        <div className="text-right">
                                                            <div className="text-2xl font-bold text-green-700">
                                                                ${(() => {
                                                                    if (!benefits.deductibleCountsTowardOOP) {
                                                                        // Pay deductible + full OOP
                                                                        return (calculation.currentStatus.remainingDeductible + calculation.currentStatus.remainingOOP).toLocaleString();
                                                                    } else {
                                                                        // Just OOP (which includes deductible)
                                                                        return calculation.currentStatus.remainingOOP.toLocaleString();
                                                                    }
                                                                })()}
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <div className="text-sm text-gray-600 space-y-2">
                                                        <div className="bg-green-50 p-3 rounded border border-green-200">
                                                            <div className="font-medium mb-1">What This Covers:</div>
                                                            <div className="space-y-1 text-xs">
                                                                {!benefits.deductibleCountsTowardOOP && calculation.currentStatus.remainingDeductible > 0 && (
                                                                    <div>• Pays remaining deductible: ${calculation.currentStatus.remainingDeductible.toLocaleString()}</div>
                                                                )}
                                                                <div>• Satisfies entire OOP maximum for the year</div>
                                                                <div>• Insurance pays 100% immediately</div>
                                                                <div>• ALL covered services FREE rest of year</div>
                                                                <div>• Best value for ongoing treatment needs</div>
                                                            </div>
                                                        </div>
                                                        <div className="bg-white p-3 rounded border border-green-300">
                                                            <div className="text-center">
                                                                <div className="text-lg font-bold text-green-700">$0 Future Costs</div>
                                                                <div className="text-xs text-green-600">Complete financial protection</div>
                                                            </div>
                                                        </div>
                                                        <div className="bg-purple-50 p-3 rounded mt-2 border border-purple-200">
                                                            <div className="font-medium mb-1 text-purple-800">When Insurance Pays 100%:</div>
                                                            <div className="text-xs text-purple-700 font-semibold">
                                                                Immediately after this payment! ✨
                                                            </div>
                                                            <div className="text-xs text-purple-600 mt-1">
                                                                No more out-of-pocket costs for covered services this year
                                                            </div>
                                                        </div>
                                                        {!benefits.deductibleCountsTowardOOP && calculation.currentStatus.remainingDeductible > 0 && (
                                                            <div className="mt-2 p-2 bg-amber-50 rounded border border-amber-200">
                                                                <div className="text-xs text-amber-700">
                                                                    <strong>Total Payment Breakdown:</strong>
                                                                    <br/>Deductible: ${calculation.currentStatus.remainingDeductible.toLocaleString()}
                                                                    <br/>+ OOP Max: ${calculation.currentStatus.remainingOOP.toLocaleString()}
                                                                    <br/>= Total: ${(calculation.currentStatus.remainingDeductible + calculation.currentStatus.remainingOOP).toLocaleString()}
                                                                </div>
                                                            </div>
                                                        )}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        {/* Detailed Breakdown */}
                                        <div className="bg-white rounded-lg shadow-sm p-6">
                                            <h3 className="text-lg font-semibold text-gray-800 mb-4">Cost Breakdown</h3>
                                            
                                            <div className="mb-6">
                                                <h4 className="text-sm font-medium text-gray-700 mb-3">Selected Services</h4>
                                                <div className="space-y-2">
                                                    {calculation.services.map((service, idx) => (
                                                        <div key={idx} className="flex justify-between items-center py-2 border-b border-gray-100">
                                                            <span className="text-sm text-gray-600">
                                                                {serviceInfo[service.name].fullName} ({service.days} days @ ${service.dailyRate}/day)
                                                            </span>
                                                            <span className="font-medium">${service.totalCost.toLocaleString()}</span>
                                                        </div>
                                                    ))}
                                                </div>
                                            </div>

                                            <div className="space-y-3">
                                                <div className="flex justify-between items-center py-2">
                                                    <span className="text-sm text-gray-600">Total Provider Charges</span>
                                                    <span className="font-medium">${calculation.totals.providerCharges.toLocaleString()}</span>
                                                </div>
                                                
                                                <div className="border-t pt-3">
                                                    <div className="flex justify-between items-center py-1">
                                                        <span className="text-sm text-gray-600">
                                                            Deductible Applied
                                                            {!benefits.deductibleCountsTowardOOP && (
                                                                <span className="text-xs text-amber-600 ml-1">(not toward OOP)</span>
                                                            )}
                                                        </span>
                                                        <span className="font-medium text-red-600">-${calculation.totals.deductibleApplied.toLocaleString()}</span>
                                                    </div>
                                                    
                                                    <div className="flex justify-between items-center py-1">
                                                        <span className="text-sm text-gray-600">Coinsurance ({benefits.coinsurance}%)</span>
                                                        <span className="font-medium text-red-600">-${calculation.totals.coinsuranceAmount.toLocaleString()}</span>
                                                    </div>
                                                </div>
                                                
                                                {calculation.totals.oopMaxReached && (
                                                    <div className="py-2 px-3 bg-green-50 rounded border border-green-200">
                                                        <div className="text-sm text-green-700 font-medium">
                                                            Out-of-Pocket Maximum Reached
                                                        </div>
                                                    </div>
                                                )}
                                                
                                                <div className="flex justify-between items-center py-3 border-t font-semibold">
                                                    <span>Total Client Responsibility</span>
                                                    <span className="text-lg text-indigo-600">${calculation.totals.totalClientCost.toLocaleString()}</span>
                                                </div>
                                            </div>

                                            <div className="mt-6 p-4 bg-gray-50 rounded-lg">
                                                <h4 className="text-sm font-medium text-gray-700 mb-3">Benefit Status After This Service</h4>
                                                <div className="space-y-3">
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-600">Deductible Remaining</span>
                                                            <span className="font-medium">
                                                                ${calculation.totals.remainingDeductible.toLocaleString()} of ${(parseFloat(benefits.deductible) || 0).toLocaleString()}
                                                            </span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div 
                                                                className="bg-blue-600 h-2 rounded-full transition-all duration-300"
                                                                style={{width: `${Math.min(100, (((parseFloat(benefits.deductible) || 0) - calculation.totals.remainingDeductible) / (parseFloat(benefits.deductible) || 1)) * 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                    <div>
                                                        <div className="flex justify-between text-xs mb-1">
                                                            <span className="text-gray-600">Out-of-Pocket Remaining</span>
                                                            <span className="font-medium">
                                                                ${calculation.totals.remainingOOP.toLocaleString()} of ${(parseFloat(benefits.oopMax) || 0).toLocaleString()}
                                                            </span>
                                                        </div>
                                                        <div className="w-full bg-gray-200 rounded-full h-2">
                                                            <div 
                                                                className="bg-green-600 h-2 rounded-full transition-all duration-300"
                                                                style={{width: `${Math.min(100, (((parseFloat(benefits.oopMax) || 0) - calculation.totals.remainingOOP) / (parseFloat(benefits.oopMax) || 1)) * 100)}%`}}
                                                            ></div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>

                                        <div className="bg-amber-50 border border-amber-200 rounded-lg p-4">
                                            <p className="text-sm text-amber-800">
                                                <strong>Disclaimer:</strong> This is an estimate based on the benefits information provided. 
                                                Actual costs may vary depending on final coding, medical necessity determinations, and other factors.
                                            </p>
                                        </div>
                                    </div>
                                ) : (
                                    <div className="bg-white rounded-lg shadow-sm p-12 text-center">
                                        <div className="text-gray-400 mb-4">
                                            <svg className="w-16 h-16 mx-auto" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                                <path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M9 7h6m0 10v-3m-3 3h.01M9 17h.01M9 14h.01M12 14h.01M15 11h.01M12 11h.01M9 11h.01M7 21h10a2 2 0 002-2V5a2 2 0 00-2-2H7a2 2 0 00-2 2v14a2 2 0 002 2z" />
                                            </svg>
                                        </div>
                                        <h3 className="text-lg font-medium text-gray-800 mb-2">No Calculation Yet</h3>
                                        <p className="text-gray-600">Enter benefits information and select services to see the cost calculation</p>
                                    </div>
                                )}
                            </div>
                        </div>

                        {/* Footer */}
                        <div className="mt-8 text-center text-sm text-gray-500">
                            <p>Free Insurance Benefits Calculator - No registration required</p>
                        </div>
                    </div>
                </div>
            );
        }

        ReactDOM.render(<InsuranceBenefitsCalculator />, document.getElementById('root'));
    </script>
</body>
</html>
